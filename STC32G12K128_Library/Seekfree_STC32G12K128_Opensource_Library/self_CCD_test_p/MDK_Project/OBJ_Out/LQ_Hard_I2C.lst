C251 COMPILER V5.60.0,  LQ_Hard_I2C                                                        18/11/25  13:39:09  PAGE 1   


C251 COMPILER V5.60.0, COMPILATION OF MODULE LQ_Hard_I2C
OBJECT MODULE PLACED IN .\OBJ_Out\LQ_Hard_I2C.obj
COMPILER INVOKED BY: D:\MDK\C251\BIN\C251.EXE ..\..\libraries\LQ_LIB\Src\LQ_Hard_I2C.c XSMALL OPTIMIZE(6,SPEED) REGFILE(
                    -.\OBJ_Out\LQ_STCAI32_LIB.ORC) BROWSE INCDIR(..\..\libraries\Driver;..\..\libraries\Driver\Inc;..\..\libraries\Include;..
                    -\..\libraries\LQ_LIB\Inc;..\User;..\code;..\Hardware;..\..\libraries\zf_common;..\..\Libraries\zf_components;..\..\Libra
                    -ries\zf_device;..\..\Libraries\zf_driver) DEFINE(STC32G) DEBUG PRINT(.\OBJ_Out\LQ_Hard_I2C.lst) OBJECT(.\OBJ_Out\LQ_Hard
                    -_I2C.obj) 

stmt  level    source

    1          /*LLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLL
    2           【平    台】北京龙邱智能科技STC32位核心板
    3           【编    写】龙邱科技
    4           【E-mail  】chiusir@163.com
    5           【软件版本】V1.0 版权所有，单位使用请先联系授权
    6           【相关信息参考下列地址】
    7           【网    站】http://www.lqist.cn
    8           【淘宝店铺】http://longqiu.taobao.com
    9           --------------------------------------------------------------------------------
   10           【  IDE  】 keil C251 V5.60
   11           【Target 】 STC32G/STC8051U/AI8051U 32位模式
   12           【SYS CLK】 42 MHz使用内部晶振
   13          QQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQ*/
   14          
   15          
   16          #include "include.h"
   17          #include "LQ_Hard_I2C.h"
   18          #include "AI8051U_I2C.h"
   19          
   20          //========================================================================
   21          // 函数: void I2C_WriteNbyte(u8 dev_addr, u8 mem_addr, u8 *p, u8 number)
   22          // 描述: I2C写入数据函数.
   23          // 参数: dev_addr: 设备地址, mem_addr: 存储地址, *p写入数据存储位置, number写入数据个数.
   24          // 返回: none.
   25          // 版本: V1.0, 2020-09-15
   26          //========================================================================
   27          void Hard_I2C_WriteNbyte(u8 dev_addr, u8 mem_addr, u8 *p, u8 number)
   28          {
   29   1              Start();                        // 发送起始命令
   30   1              SendData(dev_addr); // 发送设备地址+写命令
   31   1              RecvACK();
   32   1              SendData(mem_addr); // 发送存储地址
   33   1              RecvACK();
   34   1              do
   35   1              {
   36   2                      SendData(*p++);
   37   2                      RecvACK();
   38   2              } while (--number);
   39   1              Stop(); // 发送停止命令
   40   1      }
   41          
   42          //========================================================================
   43          // 函数: void I2C_ReadNbyte(u8 dev_addr, u8 mem_addr, u8 *p, u8 number)
   44          // 描述: I2C读取数据函数.
   45          // 参数: dev_addr: 设备地址, mem_addr: 存储地址, *p读取数据存储位置, number读取数据个数.
   46          // 返回: none.
   47          // 版本: V1.0, 2020-09-15
   48          //========================================================================
   49          void Hard_I2C_ReadNbyte(u8 dev_addr, u8 mem_addr, u8 *p, u8 number) 
   50          {
   51   1              Start();                        // 发送起始命令
   52   1              SendData(dev_addr); // 发送设备地址+写命令
   53   1              // RecvACK();
   54   1              SendData(mem_addr); // 发送存储地址
   55   1              // RecvACK();
C251 COMPILER V5.60.0,  LQ_Hard_I2C                                                        18/11/25  13:39:09  PAGE 2   

   56   1              Start();                                // 发送起始命令
   57   1              SendData(dev_addr | 1); // 发送设备地址+读命令
   58   1              // RecvACK();
   59   1              do
   60   1              {
   61   2                      *p = RecvData();
   62   2                      p++;
   63   2                      if (number != 1)
   64   2                              SendACK(); // send ACK
   65   2              } while (--number);
   66   1              SendNAK(); // send no ACK
   67   1              Stop();    // 发送停止命令
   68   1      }
   69          
   70          
   71          /************************************************************
   72           * @Description: 初始化硬件IIC
   73           * @param   type:选择IIC引脚
   74                                          （0：P2.4 P2.3）
   75                                          （1：P1.5 P1.4）
   76                                          （2：         ）
   77                                          （3：P3.2 P3.3）
   78            * @see    void Hard_IIC_Init();
   79            *
   80            * @date  2024-09-15
   81          *************************************************************/
   82          void Hard_IIC_Init(unsigned char type)
   83          {
   84   1          I2C_InitTypeDef I2C_InitStructure;
   85   1          
   86   1          if (type == 0) // 选择SCL:P2.4与SDA:P2.3为IIC引脚
   87   1          {
   88   2              P2_MODE_IO_PU(GPIO_Pin_3 | GPIO_Pin_4); // 将I2C管脚设为准双向口
   89   2              I2C_SW(I2C_P24_P23);                    // 选择管脚 I2C_P23_P24
   90   2          }
   91   1          else if (type == 1) // 选择P1.5与P1.4为IIC引脚
   92   1          {
   93   2              P1_MODE_IO_PU(GPIO_Pin_4 | GPIO_Pin_5); // 将I2C管脚设为准双向口
   94   2              I2C_SW(I2C_P15_P14);
   95   2          }
   96   1      #ifdef STC32G
   97   1          else if (type == 2)
   98   1          {
   99   2              I2C_SW(I2C_P76_P77); // STC32G支持的管脚        // 8051U仅三组，I2C_S[1:0]  可选值0，1，3 无2
  100   2          }
  101   1      #endif
  102   1          else if (type == 3) // 选择P3.2与P3.3为IIC引脚
  103   1          {
  104   2              P3_MODE_IO_PU(GPIO_Pin_2 | GPIO_Pin_3); // 将I2C管脚设为准双向口
  105   2              // I2C_S1=1;I2C_S0=1;
  106   2              I2C_SW(I2C_P32_P33); // I2C_P24_P23; I2C_P15_P14; I2C_P32_P33
  107   2          }
  108   1      
  109   1          I2C_InitStructure.I2C_Mode = I2C_Mode_Master; // 主从选择   I2C_Mode_Master, I2C_Mode_Slave
  110   1          I2C_InitStructure.I2C_Enable = ENABLE;        // I2C功能使能,   ENABLE, DISABLE
  111   1          I2C_InitStructure.I2C_MS_WDTA = ENABLE;      // 主机使能自动发送,  ENABLE, DISABLE
  112   1          I2C_InitStructure.I2C_Speed = 63;             // 总线速度=Fosc/2/(Speed*2+4),      0~63
  113   1          I2C_Init(&I2C_InitStructure);
  114   1          NVIC_I2C_Init(I2C_Mode_Master, DISABLE, Priority_0); // 主从模式, I2C_Mode_Master, I2C_Mode_Slave; 中
             -断使能, ENABLE/DISABLE; 优先级(低到高) Priority_0,Priority_1,Priority_2,Priority_3
  115   1      }


Module Information          Static   Overlayable
------------------------------------------------
  code size            =       220     ------
  ecode size           =    ------     ------
C251 COMPILER V5.60.0,  LQ_Hard_I2C                                                        18/11/25  13:39:09  PAGE 3   

  data size            =    ------     ------
  idata size           =    ------     ------
  pdata size           =    ------     ------
  xdata size           =    ------     ------
  xdata-const size     =    ------     ------
  edata size           =    ------          6
  bit size             =    ------     ------
  ebit size            =    ------     ------
  bitaddressable size  =    ------     ------
  ebitaddressable size =    ------     ------
  far data size        =    ------     ------
  huge data size       =    ------     ------
  const size           =    ------     ------
  hconst size          =    ------     ------
End of Module Information.


C251 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
