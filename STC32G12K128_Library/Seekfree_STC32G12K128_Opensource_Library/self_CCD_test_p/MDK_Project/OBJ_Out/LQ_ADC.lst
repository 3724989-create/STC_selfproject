C251 COMPILER V5.60.0,  LQ_ADC                                                             18/11/25  13:39:08  PAGE 1   


C251 COMPILER V5.60.0, COMPILATION OF MODULE LQ_ADC
OBJECT MODULE PLACED IN .\OBJ_Out\LQ_ADC.obj
COMPILER INVOKED BY: D:\MDK\C251\BIN\C251.EXE ..\..\libraries\LQ_LIB\Src\LQ_ADC.c XSMALL OPTIMIZE(6,SPEED) REGFILE(.\OBJ
                    -_Out\LQ_STCAI32_LIB.ORC) BROWSE INCDIR(..\..\libraries\Driver;..\..\libraries\Driver\Inc;..\..\libraries\Include;..\..\l
                    -ibraries\LQ_LIB\Inc;..\User;..\code;..\Hardware;..\..\libraries\zf_common;..\..\Libraries\zf_components;..\..\Libraries\
                    -zf_device;..\..\Libraries\zf_driver) DEFINE(STC32G) DEBUG PRINT(.\OBJ_Out\LQ_ADC.lst) OBJECT(.\OBJ_Out\LQ_ADC.obj) 

stmt  level    source

    1          /*LLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLL
    2           ¡¾Æ½    Ì¨¡¿±±¾©ÁúÇñÖÇÄÜ¿Æ¼¼STC32Î»ºËÐÄ°å
    3           ¡¾±à    Ð´¡¿ÁúÇñ¿Æ¼¼
    4           ¡¾E-mail  ¡¿chiusir@163.com
    5           ¡¾Èí¼þ°æ±¾¡¿V1.0 °æÈ¨ËùÓÐ£¬µ¥Î»Ê¹ÓÃÇëÏÈÁªÏµÊÚÈ¨
    6           ¡¾Ïà¹ØÐÅÏ¢²Î¿¼ÏÂÁÐµØÖ·¡¿
    7           ¡¾Íø    Õ¾¡¿http://www.lqist.cn
    8           ¡¾ÌÔ±¦µêÆÌ¡¿http://longqiu.taobao.com
    9           --------------------------------------------------------------------------------
   10           ¡¾  IDE  ¡¿ keil C251 V5.60
   11           ¡¾Target ¡¿ STC32G/STC8051U/AI8051U 32Î»Ä£Ê½
   12           ¡¾SYS CLK¡¿ 42 MHzÊ¹ÓÃÄÚ²¿¾§Õñ
   13          QQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQ*/
   14          
   15          
   16          
   17          #include "include.h"
   18          #include "LQ_ADC.h"
   19          
   20          /***********************************************************************************
   21           * º¯ Êý Ãû£ºvoid ADC_Init(void)
   22           * ¹¦    ÄÜ£ºADC³õÊ¼»¯£¬¹Ü½Å³õÊ¼»¯ºÍÖÐ¶ÏÄ£Ê½¡¢Ê¹ÄÜµÈÉèÖÃ
   23           * ²Î    Êý£ºÎÞ
   24           * ·µ »Ø Öµ£ºÎÞ
   25           * Ëµ    Ã÷£º  ADCÍ¨µ½    ¶ÔÓ¦GOIO
   26           *               ADC0       P1.0
   27           *               ADC1       P1.1
   28           *               ADC2       P1.2
   29           *               ADC3       P1.3
   30           *               ADC4       P1.4
   31           *               ADC5       P1.5
   32           *               ADC6       P1.6
   33           *               ADC7       P1.7
   34           *      
   35           *               ADC8       P0.0
   36           *               ADC9       P0.1
   37           *               ADC10      P0.2
   38           *               ADC11      P0.3
   39           *               ADC12      P0.4
   40           *               ADC13      P0.5
   41           *               ADC14      P0.6
   42           **********************************************************************************/
   43          void ADC_Init(void)
   44          {
   45   1              ADC_InitTypeDef         ADC_InitStructure;              //½á¹¹¶¨Òå
   46   1      
   47   1          //ADC ¶Ë¿ÚIOÅäÖÃ£¬ÕâÀï½«Ö§³ÖADCµÄ¶Ë¿ÚÈ«²¿ÅäÖÃÁË£¬Êµ¼ÊÇë½ö³õÊ¼»¯ÐèÒªµÄ¹Ü½Å
   48   1      //    P0_MODE_IN_HIZ(GPIO_Pin_LOW | GPIO_Pin_4 | GPIO_Pin_5 | GPIO_Pin_6);      //P0.0~P0.6 ÉèÖÃÎª¸ß×èÊäÈë
   49   1      //      P1_MODE_IN_HIZ(GPIO_Pin_All);               //P1.0~P1.7 ÉèÖÃÎª¸ß×èÊäÈë
   50   1          P0_MODE_IN_HIZ(GPIO_Pin_0);
   51   1          P1_MODE_IN_HIZ(GPIO_Pin_1|GPIO_Pin_3|GPIO_Pin_5|GPIO_Pin_7);    //»ò GPIO_InitConfig(P1_1|P1_3|P1_5|P
             -1_7,OUT_IN);
   52   1      
   53   1          //ADCÅäÖÃ
   54   1              ADC_InitStructure.ADC_SMPduty   = 31;           //ADC Ä£ÄâÐÅºÅ²ÉÑùÊ±¼ä¿ØÖÆ, 0~31£¨×¢Òâ£º SMPDUTY Ò»¶¨²»ÄÜÉèÖÃÐ¡ÓÚ
             - 10£©
C251 COMPILER V5.60.0,  LQ_ADC                                                             18/11/25  13:39:08  PAGE 2   

   55   1              ADC_InitStructure.ADC_CsSetup   = 0;            //ADC Í¨µÀÑ¡ÔñÊ±¼ä¿ØÖÆ 0(Ä¬ÈÏ),1
   56   1              ADC_InitStructure.ADC_CsHold    = 1;            //ADC Í¨µÀÑ¡Ôñ±£³ÖÊ±¼ä¿ØÖÆ 0,1(Ä¬ÈÏ),2,3
   57   1              ADC_InitStructure.ADC_Speed     = ADC_SPEED_2X16T;              //ÉèÖÃ ADC ¹¤×÷Ê±ÖÓÆµÂÊ ADC_SPEED_2X1T~ADC_SPEED_2X1
             -6T
   58   1              ADC_InitStructure.ADC_AdjResult = ADC_RIGHT_JUSTIFIED;  //ADC½á¹ûµ÷Õû,  ADC_LEFT_JUSTIFIED,ADC_RIGHT_JUSTI
             -FIED
   59   1              ADC_Inilize(&ADC_InitStructure);                //³õÊ¼»¯
   60   1              ADC_PowerControl(ENABLE);                               //ADCµçÔ´¿ª¹Ø, ENABLE»òDISABLE
   61   1              NVIC_ADC_Init(DISABLE,Priority_0);              //ÖÐ¶ÏÊ¹ÄÜ, ENABLE/DISABLE; ÓÅÏÈ¼¶(µÍµ½¸ß) Priority_0,Priority_1,Pri
             -ority_2,Priority_3
   62   1      
   63   1      }
   64          
   65          
   66          
   67          /********************************************************************************************************
   68          **º¯ÊýÐÅÏ¢ £ºGet_Adc_Average(uint8_t ADC_Channel_x,uint8_t times)
   69          **¹¦ÄÜÃèÊö £º»ñÈ¡¼¸´ÎADC1²ÉÑùÖµµÄÆ½¾ùÖµ
   70          **ÊäÈë²ÎÊý £ºADC_Channel_x , xÎª0~8
   71          **Êä³ö²ÎÊý £ºpuiADDataÎªADC¶Áµ½µÄÖµ
   72          ********************************************************************************************************/
   73          u16 ADC_Read_Average(uint8 ADC_Channel_x,uint8 times)
   74          {
   75   1          u32 temp_val=0;
   76   1          u8 t;
   77   1          u8 delay;
   78   1          for(t=0;t<times;t++)
   79   1          {
   80   2              temp_val+=Get_ADCResult(ADC_Channel_x);
   81   2              for(delay=0;delay<100;delay++);
   82   2          }
   83   1          return temp_val/times;
   84   1      }
   85          
   86          
   87          
   88          
   89          
   90          void Test_ADC()
   91          {
   92   1          char txt[20];
   93   1          ADC_Init();         //ADC³õÊ¼»¯£¬½øÈëº¯ÊýÄÚ²¿Ñ¡Ôñ¶ÔÓ¦ÐèÒªµÄ¹Ü½ÅÍ¨µÀ
   94   1          Global_IRQ_Enable();
   95   1      
   96   1          OLED_Init();                    //OLED³õÊ¼»¯
   97   1          OLED_CLS();       //¼ÓÈëOLEDÏÔÊ¾
   98   1          OLED_P8x16Str(10, 0, "Test LQ ADC ");
   99   1          
  100   1              while (1)
  101   1              {
  102   2              sprintf(txt, "ADV:%05d ", Get_ADCResult(8));  //ADC8-P00 ×öµçÔ´µçÑ¹ 11.0V->1700×óÓÒ£¬12.6V->1970×
             -óÓÒ
  103   2              OLED_P6x8Str(10,2, txt);        // ÏÔÊ¾
  104   2              sprintf(txt, "BAT:%.1fV ", Get_ADCResult(8)*0.0053f);        //ºËÐÄ°åÄ¸°å
  105   2              OLED_P6x8Str(70,2, txt);        // ÏÔÊ¾
  106   2              
  107   2              sprintf(txt, "AD1:%05d ", Get_ADCResult(1));  //ADC1-P11
  108   2              OLED_P6x8Str(10,3, txt);        // ÏÔÊ¾
  109   2              sprintf(txt, "AD3:%05d ", Get_ADCResult(3));  //ADC3-P13
  110   2              OLED_P6x8Str(10,4, txt);        // ÏÔÊ¾
  111   2              sprintf(txt, "AD5:%05d ", Get_ADCResult(5));  //ADC5-P15
  112   2              OLED_P6x8Str(10,5, txt);        // ÏÔÊ¾
  113   2              sprintf(txt, "AD7:%05d ", Get_ADCResult(7));  //ADC7-P17
  114   2              OLED_P6x8Str(10,6, txt);        // ÏÔÊ¾
  115   2              delay_ms(100);
  116   2              }
C251 COMPILER V5.60.0,  LQ_ADC                                                             18/11/25  13:39:08  PAGE 3   

  117   1      
  118   1      }
  119          
  120          


Module Information          Static   Overlayable
------------------------------------------------
  code size            =       382     ------
  ecode size           =    ------     ------
  data size            =    ------     ------
  idata size           =    ------     ------
  pdata size           =    ------     ------
  xdata size           =    ------     ------
  xdata-const size     =    ------     ------
  edata size           =    ------         25
  bit size             =    ------     ------
  ebit size            =    ------     ------
  bitaddressable size  =    ------     ------
  ebitaddressable size =    ------     ------
  far data size        =    ------     ------
  huge data size       =    ------     ------
  const size           =    ------     ------
  hconst size          =        74     ------
End of Module Information.


C251 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
