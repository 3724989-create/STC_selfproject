C251 COMPILER V5.60.0,  AI8051U_RTC                                                        18/11/25  13:45:59  PAGE 1   


C251 COMPILER V5.60.0, COMPILATION OF MODULE AI8051U_RTC
OBJECT MODULE PLACED IN .\OBJ_Out\AI8051U_RTC.obj
COMPILER INVOKED BY: D:\MDK\C251\BIN\C251.EXE ..\..\libraries\Driver\Src\AI8051U_RTC.c XSMALL UNSIGNED_CHAR FLOAT64 BROW
                    -SE INCDIR(..\..\libraries\Driver;..\..\libraries\Include;..\..\libraries\Driver\Inc;..\..\libraries\LQ_LIB\Inc;..\User) 
                    -DEFINE(AI8051U_32Bit) DEBUG PRINT(.\OBJ_Out\AI8051U_RTC.lst) OBJECT(.\OBJ_Out\AI8051U_RTC.obj) 

stmt  level    source

    1          /*---------------------------------------------------------------------*/
    2          /* ------------------- Web: www.STCAI.com -----------------------------*/
    3          /*---------------------------------------------------------------------*/
    4          
    5          #include        "AI8051U_RTC.h"
    6          
    7          //========================================================================
    8          // 函数: u8     ADC_Inilize(ADC_InitTypeDef *ADCx)
    9          // 描述: ADC初始化程序.
   10          // 参数: ADCx: 结构参数,请参考头文件里的定义.
   11          // 返回: none.
   12          // 版本: V1.0, 2012-10-22
   13          //========================================================================
   14          u8      RTC_Inilize(RTC_InitTypeDef *RTCx)
   15          {
   16   1              if(RTCx->RTC_Year > 99)         return FAIL;    //错误
   17   1              if(RTCx->RTC_Month > 12)        return FAIL;    //错误
   18   1              if(RTCx->RTC_Day > 31)          return FAIL;    //错误
   19   1              if(RTCx->RTC_Hour > 23)         return FAIL;    //错误
   20   1              if(RTCx->RTC_Min > 59)          return FAIL;    //错误
   21   1              if(RTCx->RTC_Sec > 59)          return FAIL;    //错误
   22   1              if(RTCx->RTC_Ssec > 127)        return FAIL;    //错误
   23   1              if(RTCx->RTC_ALAHour > 23)      return FAIL;    //错误
   24   1              if(RTCx->RTC_ALAMin > 59)       return FAIL;    //错误
   25   1              if(RTCx->RTC_ALASec > 59)       return FAIL;    //错误
   26   1              if(RTCx->RTC_ALASsec > 127)     return FAIL;    //错误
   27   1      
   28   1              INIYEAR = RTCx->RTC_Year;
   29   1              INIMONTH = RTCx->RTC_Month;
   30   1              INIDAY = RTCx->RTC_Day;
   31   1              INIHOUR = RTCx->RTC_Hour;
   32   1              INIMIN = RTCx->RTC_Min;
   33   1              INISEC = RTCx->RTC_Sec;
   34   1              INISSEC = RTCx->RTC_Ssec;
   35   1      
   36   1              ALAHOUR = RTCx->RTC_ALAHour;    //闹钟小时
   37   1              ALAMIN  = RTCx->RTC_ALAMin;             //闹钟分钟
   38   1              ALASEC  = RTCx->RTC_ALASec;             //闹钟秒
   39   1              ALASSEC = RTCx->RTC_ALASsec;    //闹钟1/128秒
   40   1      
   41   1              if(RTCx->RTC_Clock == RTC_IRC32KCR)
   42   1              {
   43   2          //STC32G 芯片使用内部32K时钟，休眠无法唤醒
   44   2                      IRC32KCR = 0x80;   //启动内部32K晶振.
   45   2                      while (!(IRC32KCR & 1));  //等待时钟稳定
   46   2                      RTCCFG = 0x03;    //选择内部32K时钟源，触发RTC寄存器初始化
   47   2              }
   48   1              else
   49   1              {
   50   2                      X32KCR = 0x80 + 0x40;   //启动外部32K晶振, 低增益+0x00, 高增益+0x40.
   51   2                      while (!(X32KCR & 1));  //等待时钟稳定
   52   2                      RTCCFG = 0x01;    //选择外部32K时钟源，触发RTC寄存器初始化
   53   2              }
   54   1      
   55   1              if(RTCx->RTC_Enable == ENABLE)
   56   1              {
   57   2                      RTCCR = 0x01;     //RTC使能
C251 COMPILER V5.60.0,  AI8051U_RTC                                                        18/11/25  13:45:59  PAGE 2   

   58   2                      while(RTCCFG & 0x01);   //等待初始化完成,需要在 "RTC使能" 之后判断.
   59   2                      //设置RTC时间需要32768Hz的1个周期时间,大约30.5us. 由于同步, 所以实际等待时间是0~30.5us.
   60   2                      //如果不等待设置完成就睡眠, 则RTC会由于设置没完成, 停止计数, 唤醒后才继续完成设置并继续计数.
   61   2              }
   62   1              else
   63   1              {
   64   2                      RTCCR = 0x00;     //RTC关闭
   65   2              }
   66   1      
   67   1              return SUCCESS;
   68   1      }
   69          
   70          


Module Information          Static   Overlayable
------------------------------------------------
  code size            =       375     ------
  ecode size           =    ------     ------
  data size            =    ------     ------
  idata size           =    ------     ------
  pdata size           =    ------     ------
  xdata size           =    ------     ------
  xdata-const size     =    ------     ------
  edata size           =    ------     ------
  bit size             =    ------     ------
  ebit size            =    ------     ------
  bitaddressable size  =    ------     ------
  ebitaddressable size =    ------     ------
  far data size        =    ------     ------
  huge data size       =    ------     ------
  const size           =    ------     ------
  hconst size          =    ------     ------
End of Module Information.


C251 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
