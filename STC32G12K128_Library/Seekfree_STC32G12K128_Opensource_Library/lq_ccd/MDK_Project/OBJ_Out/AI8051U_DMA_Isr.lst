C251 COMPILER V5.60.0,  AI8051U_DMA_Isr                                                    18/11/25  13:45:57  PAGE 1   


C251 COMPILER V5.60.0, COMPILATION OF MODULE AI8051U_DMA_Isr
OBJECT MODULE PLACED IN .\OBJ_Out\AI8051U_DMA_Isr.obj
COMPILER INVOKED BY: D:\MDK\C251\BIN\C251.EXE ..\..\libraries\Driver\isr\AI8051U_DMA_Isr.c XSMALL UNSIGNED_CHAR FLOAT64 
                    -BROWSE INCDIR(..\..\libraries\Driver;..\..\libraries\Include;..\..\libraries\Driver\Inc;..\..\libraries\LQ_LIB\Inc;..\Us
                    -er) DEFINE(AI8051U_32Bit) DEBUG PRINT(.\OBJ_Out\AI8051U_DMA_Isr.lst) OBJECT(.\OBJ_Out\AI8051U_DMA_Isr.obj) 

stmt  level    source

    1          /*---------------------------------------------------------------------*/
    2          /* ------------------- Web: www.STCAI.com -----------------------------*/
    3          /*---------------------------------------------------------------------*/
    4          
    5          #include "AI8051U_DMA.h"
    6          #include "AI8051U_SPI.h"
    7          #include "AI8051U_LCM.h"
    8          
    9          bit     DmaTx1Flag;
   10          bit     DmaRx1Flag;
   11          bit     DmaTx2Flag;
   12          bit     DmaRx2Flag;
   13          bit     DmaTx3Flag;
   14          bit     DmaRx3Flag;
   15          bit     DmaTx4Flag;
   16          bit     DmaRx4Flag;
   17          
   18          u16 LCM_Cnt;
   19          bit DmaLcmFlag;
   20          
   21          bit DmaADCFlag = 0;
   22          bit DmaM2MFlag = 0;
   23          bit     DmaI2CTFlag=0;
   24          bit     DmaI2CRFlag=0;
   25          
   26          bit     SpiTxFlag;
   27          bit     SpiRxFlag;
   28          
   29          bit     u2sFlag;    //UART to SPI
   30          bit     s2uFlag;    //SPI to UART
   31          
   32          bit     SpiSendFlag;
   33          bit     UartSendFlag;
   34          
   35          ////========================================================================
   36          //// 函数: DMA_ADC_ISR_Handler
   37          //// 描述: DMA ADC 中断函数.
   38          //// 参数: none.
   39          //// 返回: none.
   40          //// 版本: V1.0, 2022-03-23
   41          ////========================================================================
   42          //void DMA_ADC_ISR_Handler (void) interrupt DMA_ADC_VECTOR
   43          //{
   44          //      // TODO: 在此处添加用户代码
   45          //      if(DMA_ADC_STA & 0x01)  //AD转换完成
   46          //      {
   47          //              DMA_ADC_STA &= ~0x01;   //清标志位
   48          //              DmaADCFlag = 1;
   49          //      }
   50          //}
   51          
   52          ////========================================================================
   53          //// 函数: DMA_M2M_ISR_Handler
   54          //// 描述: DMA M2M 中断函数.
   55          //// 参数: none.
   56          //// 返回: none.
   57          //// 版本: V1.0, 2022-03-23
C251 COMPILER V5.60.0,  AI8051U_DMA_Isr                                                    18/11/25  13:45:57  PAGE 2   

   58          ////========================================================================
   59          //void DMA_M2M_ISR_Handler (void) interrupt DMA_M2M_VECTOR
   60          //{
   61          //      // TODO: 在此处添加用户代码
   62          //      if(DMA_M2M_STA & 0x01)  //M2M传输完成
   63          //      {
   64          //              DMA_M2M_STA &= ~0x01;   //清标志位
   65          //              DmaM2MFlag = 1;
   66          //              if(u2sFlag)
   67          //              {
   68          //                      u2sFlag = 0;
   69          //                      SpiSendFlag = 1;
   70          //              }
   71          //              if(s2uFlag)
   72          //              {
   73          //                      s2uFlag = 0;
   74          //                      UartSendFlag = 1;
   75          //              }
   76          //      }
   77          //}
   78          
   79          ////========================================================================
   80          //// 函数: DMA_UART1TX_ISR_Handler
   81          //// 描述: DMA UART1 TX 中断函数.
   82          //// 参数: none.
   83          //// 返回: none.
   84          //// 版本: V1.0, 2022-03-23
   85          ////========================================================================
   86          //void DMA_UART1TX_ISR_Handler (void) interrupt DMA_UR1T_VECTOR
   87          //{
   88          //      // TODO: 在此处添加用户代码
   89          //      if (DMA_UR1T_STA & 0x01)        //发送完成
   90          //      {
   91          //              DMA_UR1T_STA &= ~0x01;  //清标志位
   92          //              DmaTx1Flag = 1;
   93          //      }
   94          //      if (DMA_UR1T_STA & 0x04)        //数据覆盖
   95          //      {
   96          //              DMA_UR1T_STA &= ~0x04;  //清标志位
   97          //      }
   98          //}
   99          
  100          ////========================================================================
  101          //// 函数: DMA_UART1RX_ISR_Handler
  102          //// 描述: DMA UART1 RX 中断函数.
  103          //// 参数: none.
  104          //// 返回: none.
  105          //// 版本: V1.0, 2022-03-23
  106          ////========================================================================
  107          //void DMA_UART1RX_ISR_Handler (void) interrupt DMA_UR1R_VECTOR
  108          //{
  109          //      // TODO: 在此处添加用户代码
  110          //      if (DMA_UR1R_STA & 0x01)        //接收完成
  111          //      {
  112          //              DMA_UR1R_STA &= ~0x01;  //清标志位
  113          //              DmaRx1Flag = 1;
  114          
  115          ////            DMA_UR1T_TRIG();        //重新触发UART1发送功能
  116          ////            DMA_UR1R_TRIG();        //重新触发UART1接收功能
  117          //      }
  118          //      if (DMA_UR1R_STA & 0x02)        //数据丢弃
  119          //      {
  120          //              DMA_UR1R_STA &= ~0x02;  //清标志位
  121          //      }
  122          //}
  123          
C251 COMPILER V5.60.0,  AI8051U_DMA_Isr                                                    18/11/25  13:45:57  PAGE 3   

  124          ////========================================================================
  125          //// 函数: DMA_UART2TX_ISR_Handler
  126          //// 描述: DMA UART2 TX 中断函数.
  127          //// 参数: none.
  128          //// 返回: none.
  129          //// 版本: V1.0, 2022-03-23
  130          ////========================================================================
  131          //void DMA_UART2TX_ISR_Handler (void) interrupt DMA_UR2T_VECTOR
  132          //{
  133          //      // TODO: 在此处添加用户代码
  134          //      if (DMA_UR2T_STA & 0x01)        //发送完成
  135          //      {
  136          //              DMA_UR2T_STA &= ~0x01;  //清标志位
  137          //              DmaTx2Flag = 1;
  138          //      }
  139          //      if (DMA_UR2T_STA & 0x04)        //数据覆盖
  140          //      {
  141          //              DMA_UR2T_STA &= ~0x04;  //清标志位
  142          //      }
  143          //}
  144          
  145          ////========================================================================
  146          //// 函数: DMA_UART2RX_ISR_Handler
  147          //// 描述: DMA UART2 RX 中断函数.
  148          //// 参数: none.
  149          //// 返回: none.
  150          //// 版本: V1.0, 2022-03-23
  151          ////========================================================================
  152          //void DMA_UART2RX_ISR_Handler (void) interrupt DMA_UR2R_VECTOR
  153          //{
  154          //      // TODO: 在此处添加用户代码
  155          //      if (DMA_UR2R_STA & 0x01)        //接收完成
  156          //      {
  157          //              DMA_UR2R_STA &= ~0x01;  //清标志位
  158          //              DmaRx2Flag = 1;
  159          
  160          ////            DMA_UR2T_TRIG();        //重新触发UART2发送功能
  161          ////            DMA_UR2R_TRIG();        //重新触发UART2接收功能
  162          //      }
  163          //      if (DMA_UR2R_STA & 0x02)        //数据丢弃
  164          //      {
  165          //              DMA_UR2R_STA &= ~0x02;  //清标志位
  166          //      }
  167          //}
  168          
  169          ////========================================================================
  170          //// 函数: DMA_UART3TX_ISR_Handler
  171          //// 描述: DMA UART3 TX 中断函数.
  172          //// 参数: none.
  173          //// 返回: none.
  174          //// 版本: V1.0, 2022-03-23
  175          ////========================================================================
  176          //void DMA_UART3TX_ISR_Handler (void) interrupt DMA_UR3T_VECTOR
  177          //{
  178          //      // TODO: 在此处添加用户代码
  179          //      if (DMA_UR3T_STA & 0x01)        //发送完成
  180          //      {
  181          //              DMA_UR3T_STA &= ~0x01;  //清标志位
  182          //              DmaTx3Flag = 1;
  183          //      }
  184          //      if (DMA_UR3T_STA & 0x04)        //数据覆盖
  185          //      {
  186          //              DMA_UR3T_STA &= ~0x04;  //清标志位
  187          //      }
  188          //}
  189          
C251 COMPILER V5.60.0,  AI8051U_DMA_Isr                                                    18/11/25  13:45:57  PAGE 4   

  190          ////========================================================================
  191          //// 函数: DMA_UART3RX_ISR_Handler
  192          //// 描述: DMA UART3 RX 中断函数.
  193          //// 参数: none.
  194          //// 返回: none.
  195          //// 版本: V1.0, 2022-03-23
  196          ////========================================================================
  197          //void DMA_UART3RX_ISR_Handler (void) interrupt DMA_UR3R_VECTOR
  198          //{
  199          //      // TODO: 在此处添加用户代码
  200          //      if (DMA_UR3R_STA & 0x01)        //接收完成
  201          //      {
  202          //              DMA_UR3R_STA &= ~0x01;  //清标志位
  203          //              DmaRx3Flag = 1;
  204          
  205          ////            DMA_UR3T_TRIG();        //重新触发UART3发送功能
  206          ////            DMA_UR3R_TRIG();        //重新触发UART3接收功能
  207          //      }
  208          //      if (DMA_UR3R_STA & 0x02)        //数据丢弃
  209          //      {
  210          //              DMA_UR3R_STA &= ~0x02;  //清标志位
  211          //      }
  212          //}
  213          
  214          ////========================================================================
  215          //// 函数: DMA_UART4TX_ISR_Handler
  216          //// 描述: DMA UART4 TX 中断函数.
  217          //// 参数: none.
  218          //// 返回: none.
  219          //// 版本: V1.0, 2022-03-23
  220          ////========================================================================
  221          //void DMA_UART4TX_ISR_Handler (void) interrupt DMA_UR4T_VECTOR
  222          //{
  223          //      // TODO: 在此处添加用户代码
  224          //      if (DMA_UR4T_STA & 0x01)        //发送完成
  225          //      {
  226          //              DMA_UR4T_STA &= ~0x01;  //清标志位
  227          //              DmaTx4Flag = 1;
  228          //      }
  229          //      if (DMA_UR4T_STA & 0x04)        //数据覆盖
  230          //      {
  231          //              DMA_UR4T_STA &= ~0x04;  //清标志位
  232          //      }
  233          //}
  234          
  235          ////========================================================================
  236          //// 函数: DMA_UART4RX_ISR_Handler
  237          //// 描述: DMA UART4 RX 中断函数.
  238          //// 参数: none.
  239          //// 返回: none.
  240          //// 版本: V1.0, 2022-03-23
  241          ////========================================================================
  242          //void DMA_UART4RX_ISR_Handler (void) interrupt DMA_UR4R_VECTOR
  243          //{
  244          //      // TODO: 在此处添加用户代码
  245          //      if (DMA_UR4R_STA & 0x01)        //接收完成
  246          //      {
  247          //              DMA_UR4R_STA &= ~0x01;  //清标志位
  248          //              DmaRx4Flag = 1;
  249          
  250          ////            DMA_UR4T_TRIG();        //重新触发UART4发送功能
  251          ////            DMA_UR4R_TRIG();        //重新触发UART4接收功能
  252          //      }
  253          //      if (DMA_UR4R_STA & 0x02)        //数据丢弃
  254          //      {
  255          //              DMA_UR4R_STA &= ~0x02;  //清标志位
C251 COMPILER V5.60.0,  AI8051U_DMA_Isr                                                    18/11/25  13:45:57  PAGE 5   

  256          //      }
  257          //}
  258          
  259          ////========================================================================
  260          //// 函数: DMA_SPI_ISR_Handler
  261          //// 描述: DMA SPI 中断函数.
  262          //// 参数: none.
  263          //// 返回: none.
  264          //// 版本: V1.0, 2022-03-23
  265          ////========================================================================
  266          //void DMA_SPI_ISR_Handler (void) interrupt DMA_SPI_VECTOR
  267          //{
  268          //      // TODO: 在此处添加用户代码
  269          //      if(DMA_SPI_STA & 0x01)  //通信完成
  270          //      {
  271          //              DMA_SPI_STA &= ~0x01;   //清标志位
  272          //              if(MSTR)
  273          //              { //主机模式
  274          //                      SpiTxFlag = 1;
  275          //                      SPI_SS_2 = 1;
  276          //              }
  277          //              else
  278          //              { //从机模式
  279          //                      SpiRxFlag = 1;
  280          //              }
  281          //      }
  282          //      if(DMA_SPI_STA & 0x02)  //数据丢弃
  283          //      {
  284          //              DMA_SPI_STA &= ~0x02;   //清标志位
  285          //      }
  286          //      if(DMA_SPI_STA & 0x04)  //数据覆盖
  287          //      {
  288          //              DMA_SPI_STA &= ~0x04;   //清标志位
  289          //      }
  290          //}
  291          
  292          ////========================================================================
  293          //// 函数: DMA_I2C_ISR_Handler
  294          //// 描述: DMA I2C 发送中断函数.
  295          //// 参数: none.
  296          //// 返回: none.
  297          //// 版本: V1.0, 2022-03-25
  298          ////========================================================================
  299          //void DMA_I2CT_ISR_Handler (void) interrupt DMA_I2CT_VECTOR
  300          //{
  301          //      // TODO: 在此处添加用户代码
  302          //      if(DMA_I2CT_STA & 0x01)   //发送完成
  303          //      {
  304          //              DMA_I2CT_STA &= ~0x01;  //清除标志位
  305          //              DmaI2CTFlag = 0;
  306          //      }
  307          //      if(DMA_I2CT_STA & 0x04)   //数据覆盖
  308          //      {
  309          //              DMA_I2CT_STA &= ~0x04;  //清除标志位
  310          //      }
  311          //}
  312          
  313          ////========================================================================
  314          //// 函数: DMA_I2CR_ISR_Handler
  315          //// 描述: DMA I2C 接收中断函数.
  316          //// 参数: none.
  317          //// 返回: none.
  318          //// 版本: V1.0, 2022-03-25
  319          ////========================================================================
  320          //void DMA_I2CR_ISR_Handler (void) interrupt DMA_I2CR_VECTOR
  321          //{
C251 COMPILER V5.60.0,  AI8051U_DMA_Isr                                                    18/11/25  13:45:57  PAGE 6   

  322          //      // TODO: 在此处添加用户代码
  323          //      if(DMA_I2CR_STA & 0x01)   //接收完成
  324          //      {
  325          //              DMA_I2CR_STA &= ~0x01;  //清除标志位
  326          //              DmaI2CRFlag = 0;
  327          //      }
  328          //      if(DMA_I2CR_STA & 0x02)   //数据丢弃
  329          //      {
  330          //              DMA_I2CR_STA &= ~0x02;  //清除标志位
  331          //      }
  332          //}
  333          
  334          ////========================================================================
  335          //// 函数: DMA_LCM_ISR_Handler
  336          //// 描述: DMA LCM 中断函数.
  337          //// 参数: none.
  338          //// 返回: none.
  339          //// 版本: V1.0, 2022-03-23
  340          ////========================================================================
  341          //void DMA_LCM_ISR_Handler (void) interrupt DMA_LCM_VECTOR
  342          //{
  343          //      // TODO: 在此处添加用户代码
  344          //      if(DMA_LCM_STA & 0x01)
  345          //      {
  346          //              if(DmaLcmFlag)
  347          //              {
  348          //                      DmaLcmFlag = 0;
  349          //                      DMA_LCM_CR = 0;
  350          //              }
  351          //              else
  352          //              {
  353          //                      LCM_Cnt--;
  354          //                      if(LCM_Cnt == 0)
  355          //                      {
  356          //                              DMA_LCM_CR = 0;
  357          //                              LCD_CS=1;
  358          //                      }
  359          //                      else
  360          //                      {
  361          //                              DMA_LCM_CR = 0xa0;      //Write dat
  362          //                      }
  363          //              }
  364          //              DMA_LCM_STA = 0;                //清标志位
  365          //      }
  366          //}
  367          
  368          ////========================================================================
  369          //// 函数: DMA_ISR_Handler
  370          //// 描述: DMA中断函数.
  371          //// 参数: none.
  372          //// 返回: none.
  373          //// 版本: V1.0, 2021-05-25
  374          ////========================================================================
  375          //void DMA_ISR_Handler (void) interrupt 13
  376          //{
  377          //      // TODO: 在此处添加用户代码
  378          
  379          //      //----------- DMA ADC --------------
  380          //      if(DMA_ADC_STA & 0x01)  //AD转换完成
  381          //      {
  382          //              DMA_ADC_STA &= ~0x01;   //清标志位
  383          //              DmaADCFlag = 1;
  384          //      }
  385          
  386          //      //----------- DMA M2M --------------
  387          //      if(DMA_M2M_STA & 0x01)  //M2M传输完成
C251 COMPILER V5.60.0,  AI8051U_DMA_Isr                                                    18/11/25  13:45:57  PAGE 7   

  388          //      {
  389          //              DMA_M2M_STA &= ~0x01;   //清标志位
  390          //              DmaM2MFlag = 1;
  391          //              if(u2sFlag)
  392          //              {
  393          //                      u2sFlag = 0;
  394          //                      SpiSendFlag = 1;
  395          //              }
  396          //              if(s2uFlag)
  397          //              {
  398          //                      s2uFlag = 0;
  399          //                      UartSendFlag = 1;
  400          //              }
  401          //      }
  402          
  403          //      //---------- DMA UART1 -------------
  404          //      if (DMA_UR1T_STA & 0x01)        //发送完成
  405          //      {
  406          //              DMA_UR1T_STA &= ~0x01;  //清标志位
  407          //              DmaTx1Flag = 1;
  408          //      }
  409          //      if (DMA_UR1T_STA & 0x04)        //数据覆盖
  410          //      {
  411          //              DMA_UR1T_STA &= ~0x04;  //清标志位
  412          //      }
  413          
  414          //      if (DMA_UR1R_STA & 0x01)        //接收完成
  415          //      {
  416          //              DMA_UR1R_STA &= ~0x01;  //清标志位
  417          //              DmaRx1Flag = 1;
  418          //      }
  419          //      if (DMA_UR1R_STA & 0x02)        //数据丢弃
  420          //      {
  421          //              DMA_UR1R_STA &= ~0x02;  //清标志位
  422          //      }
  423          //      //---------- DMA UART2 -------------
  424          //      if (DMA_UR2T_STA & 0x01)        //发送完成
  425          //      {
  426          //              DMA_UR2T_STA &= ~0x01;  //清标志位
  427          //              DmaTx2Flag = 1;
  428          //      }
  429          //      if (DMA_UR2T_STA & 0x04)        //数据覆盖
  430          //      {
  431          //              DMA_UR2T_STA &= ~0x04;  //清标志位
  432          //      }
  433          
  434          //      if (DMA_UR2R_STA & 0x01)        //接收完成
  435          //      {
  436          //              DMA_UR2R_STA &= ~0x01;  //清标志位
  437          //              DmaRx2Flag = 1;
  438          //      }
  439          //      if (DMA_UR2R_STA & 0x02)        //数据丢弃
  440          //      {
  441          //              DMA_UR2R_STA &= ~0x02;  //清标志位
  442          //      }
  443          //      //---------- DMA UART3 -------------
  444          //      if (DMA_UR3T_STA & 0x01)        //发送完成
  445          //      {
  446          //              DMA_UR3T_STA &= ~0x01;  //清标志位
  447          //              DmaTx3Flag = 1;
  448          //      }
  449          //      if (DMA_UR3T_STA & 0x04)        //数据覆盖
  450          //      {
  451          //              DMA_UR3T_STA &= ~0x04;  //清标志位
  452          //      }
  453          
C251 COMPILER V5.60.0,  AI8051U_DMA_Isr                                                    18/11/25  13:45:57  PAGE 8   

  454          //      if (DMA_UR3R_STA & 0x01)        //接收完成
  455          //      {
  456          //              DMA_UR3R_STA &= ~0x01;  //清标志位
  457          //              DmaRx3Flag = 1;
  458          //      }
  459          //      if (DMA_UR3R_STA & 0x02)        //数据丢弃
  460          //      {
  461          //              DMA_UR3R_STA &= ~0x02;  //清标志位
  462          //      }
  463          //      //---------- DMA UART4 -------------
  464          //      if (DMA_UR4T_STA & 0x01)        //发送完成
  465          //      {
  466          //              DMA_UR4T_STA &= ~0x01;  //清标志位
  467          //              DmaTx4Flag = 1;
  468          //      }
  469          //      if (DMA_UR4T_STA & 0x04)        //数据覆盖
  470          //      {
  471          //              DMA_UR4T_STA &= ~0x04;  //清标志位
  472          //      }
  473          
  474          //      if (DMA_UR4R_STA & 0x01)        //接收完成
  475          //      {
  476          //              DMA_UR4R_STA &= ~0x01;  //清标志位
  477          //              DmaRx4Flag = 1;
  478          //      }
  479          //      if (DMA_UR4R_STA & 0x02)        //数据丢弃
  480          //      {
  481          //              DMA_UR4R_STA &= ~0x02;  //清标志位
  482          //      }
  483          ///*
  484          //      //---------- DMA SPI -------------
  485          //      if(DMA_SPI_STA & 0x01)  //通信完成
  486          //      {
  487          //              DMA_SPI_STA &= ~0x01;   //清标志位
  488          //              if(MSTR)
  489          //              { //主机模式
  490          //                      SpiTxFlag = 1;
  491          //                      SPI_SS_2 = 1;
  492          //              }
  493          //              else
  494          //              { //从机模式
  495          //                      SpiRxFlag = 1;
  496          //              }
  497          //      }
  498          //      if(DMA_SPI_STA & 0x02)  //数据丢弃
  499          //      {
  500          //              DMA_SPI_STA &= ~0x02;   //清标志位
  501          //      }
  502          //      if(DMA_SPI_STA & 0x04)  //数据覆盖
  503          //      {
  504          //              DMA_SPI_STA &= ~0x04;   //清标志位
  505          //      }
  506          
  507          //      //------------- LCM --------------
  508          //      if(LCMIFSTA & 0x01)
  509          //      {
  510          //              LCMIFSTA = 0x00;
  511          //              LcmFlag = 0;
  512          //      }
  513          
  514          //      //---------- DMA LCM -------------
  515          //      if(DMA_LCM_STA & 0x01)
  516          //      {
  517          //              if(DmaLcmFlag)
  518          //              {
  519          //                      DmaLcmFlag = 0;
C251 COMPILER V5.60.0,  AI8051U_DMA_Isr                                                    18/11/25  13:45:57  PAGE 9   

  520          //                      DMA_LCM_CR = 0;
  521          //              }
  522          //              else
  523          //              {
  524          //                      LCM_Cnt--;
  525          //                      if(LCM_Cnt == 0)
  526          //                      {
  527          //                              DMA_LCM_CR = 0;
  528          //                              LCD_CS=1;
  529          //                      }
  530          //                      else
  531          //                      {
  532          //                              DMA_LCM_CR = 0xa0;      //Write dat
  533          //                      }
  534          //              }
  535          //              DMA_LCM_STA = 0;                //清标志位
  536          //      }
  537          //    */
  538          //}


Module Information          Static   Overlayable
------------------------------------------------
  code size            =         8     ------
  ecode size           =    ------     ------
  data size            =    ------     ------
  idata size           =    ------     ------
  pdata size           =    ------     ------
  xdata size           =    ------     ------
  xdata-const size     =    ------     ------
  edata size           =         2     ------
  bit size             =        19     ------
  ebit size            =    ------     ------
  bitaddressable size  =    ------     ------
  ebitaddressable size =    ------     ------
  far data size        =    ------     ------
  huge data size       =    ------     ------
  const size           =    ------     ------
  hconst size          =    ------     ------
End of Module Information.


C251 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
