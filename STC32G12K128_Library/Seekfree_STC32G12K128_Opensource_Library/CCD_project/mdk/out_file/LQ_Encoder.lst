C251 COMPILER V5.60.0,  LQ_Encoder                                                         18/11/25  13:07:47  PAGE 1   


C251 COMPILER V5.60.0, COMPILATION OF MODULE LQ_Encoder
OBJECT MODULE PLACED IN .\out_file\LQ_Encoder.obj
COMPILER INVOKED BY: D:\MDK\C251\BIN\C251.EXE ..\lq_libraries\LQ_LIB\Src\LQ_Encoder.c LARGE NOALIAS FLOAT64 WARNINGLEVEL
                    -(3) OPTIMIZE(SIZE) BROWSE INCDIR(..\..\libraries\zf_common;..\..\libraries\zf_components;..\..\libraries\zf_device;..\..
                    -\libraries\zf_driver;..\user;..\code;..\Hardware;..\lq_libraries\LQ_LIB\Inc;..\lq_libraries\Include;..\lq_libraries\Driv
                    -er\Inc) DEBUG PRINT(.\out_file\LQ_Encoder.lst) OBJECT(.\out_file\LQ_Encoder.obj) 

stmt  level    source

    1          /*LLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLL
    2           ¡¾Æ½    Ì¨¡¿±±¾©ÁúÇñÖÇÄÜ¿Æ¼¼STC32Î»ºËÐÄ°å
    3           ¡¾±à    Ð´¡¿ÁúÇñ¿Æ¼¼
    4           ¡¾E-mail  ¡¿chiusir@163.com
    5           ¡¾Èí¼þ°æ±¾¡¿V1.0 °æÈ¨ËùÓÐ£¬µ¥Î»Ê¹ÓÃÇëÏÈÁªÏµÊÚÈ¨
    6           ¡¾Ïà¹ØÐÅÏ¢²Î¿¼ÏÂÁÐµØÖ·¡¿
    7           ¡¾Íø    Õ¾¡¿http://www.lqist.cn
    8           ¡¾ÌÔ±¦µêÆÌ¡¿http://longqiu.taobao.com
    9           --------------------------------------------------------------------------------
   10           ¡¾  IDE  ¡¿ keil C251 V5.60
   11           ¡¾Target ¡¿ STC32G/STC8051U/AI8051U 32Î»Ä£Ê½
   12           ¡¾SYS CLK¡¿ 42 MHzÊ¹ÓÃÄÚ²¿¾§Õñ
   13          QQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQ*/
   14          
   15          #include "include.h"
   16          
   17          
   18          /**************************************************************************
   19           * º¯ Êý Ãû£ºshort Read_Encoder(u8 encno)
   20           * º¯Êý¹¦ÄÜ£ºµ¥Î»Ê±¼ä¶ÁÈ¡±àÂëÆ÷¼ÆÊý
   21           * Èë¿Ú²ÎÊý£º±àÂëÆ÷±àºÅ  ¶¨Ê±Æ÷3/4 ¼ÆÊýÖÐ¶Ï¹Ü½ÅÎ¨Ò»¹Ì¶¨£¨STC32G¿ÉÓÐÁ½×é¿ÉÑ¡£©
   22           * ·µ »Ø Öµ£ºÂö³åÊý£¬×¢Òâ¶ÁÈ¡Ö®¼äÖÜÆÚÄÚ£¬²»Òª³¬¹ý16Î»×î´óÖµ
   23           * µ÷ÓÃ·½Ê½£ºEnc1 = Read_Encoder(1)£»
   24           **************************************************************************/
   25          short Read_Encoder(u8 encno)
   26          {
   27   1        int32 tm=0;
   28   1      
   29   1        if(encno==Enc_1)
   30   1        {
   31   2                      tm = T3H;
   32   2                      if(P05)             //±àÂëÆ÷1¼ÆÊýA:P04  DIR:P05
   33   2                              tm=(tm<<8)|T3L;
   34   2                      else
   35   2                              tm=0-((tm<<8)|T3L);
   36   2      
   37   2                      T4T3M &= ~(1<<3);
   38   2                      T3H = 0;
   39   2                      T3L = 0;
   40   2                      T4T3M |= (1<<3);
   41   2        }
   42   1        else if(encno==Enc_2)
   43   1        {
   44   2                      T4T3M &= ~(1<<7);
   45   2                      tm = T4H;
   46   2                      if(P07)             //±àÂëÆ÷£²¼ÆÊýA:P06  DIR:P07
   47   2                              tm=(tm<<8)|T4L;
   48   2                      else
   49   2                              tm=0-((tm<<8)|T4L);
   50   2      
   51   2      
   52   2                      T4H = 0;
   53   2                      T4L = 0;
   54   2                      T4T3M |= (1<<7);
   55   2        }
   56   1        return tm;
C251 COMPILER V5.60.0,  LQ_Encoder                                                         18/11/25  13:07:47  PAGE 2   

   57   1      }
   58          
   59          /*************************************************************************
   60          *  º¯ÊýÃû³Æ£ºvoid Timer_EncInit(u8 tim_x)
   61          *  ¹¦ÄÜËµÃ÷£º±àÂëÆ÷³õÊ¼»¯º¯Êý
   62          *  ²ÎÊýËµÃ÷£ºÊ¹ÓÃÄÄ¸ö¶¨Ê±Æ÷µÄ×÷ÎªÍâ²¿¼¼ÊõÊäÈëÊ¹ÓÃ
   63          *  º¯Êý·µ»Ø£ºÎÞ
   64          *  ÐÞ¸ÄÊ±¼ä£º2024Äê12ÔÂ28ÈÕ
   65          *  ±¸    ×¢£ºÇý¶¯¸ö±àÂëÆ÷£¬×¢Òâ³õÊ¼»¯ÄÄ¸ö¶¨Ê±£¬Ñ¡Ôñ¶ÔÓ¦µÄÊäÈë¹Ü½Å
   66          *************************************************************************/
   67          void Timer_EncInit(u8 tim_x)
   68          {
   69   1      //    if(tim_x == Timer0)
   70   1      //      {
   71   1      //        T3L = 0; T3H = 0;
   72   1      //        T4T3M |= 0x0C;
   73   1      //    }
   74   1      //    else if(tim_x == Timer1)
   75   1      //    {
   76   1      //        T4L = 0; T4H = 0;
   77   1      //        T4T3M |= 0xC0;
   78   1      //    }
   79   1      //    else if(tim_x == Timer2)  //³£±»ÓÃ×÷´®¿Ú²¨ÌØÂÊ·¢ÉúÆ÷ 
   80   1      //    {
   81   1      //        T4L = 0; T4H = 0;
   82   1      //        T4T3M |= 0xC0;
   83   1      //    } 
   84   1          
   85   1          if(tim_x == Timer3)
   86   1              {
   87   2              T3L = 0; T3H = 0;
   88   2              T4T3M |= 0x0C;
   89   2          }
   90   1          else if(tim_x == Timer4)
   91   1          {
   92   2              T4L = 0; T4H = 0;
   93   2              T4T3M |= 0xC0;
   94   2          }
   95   1          else if(tim_x == (Timer3|Timer4))
   96   1          {
   97   2              T3L = 0; T3H = 0;
   98   2              T4L = 0; T4H = 0;
   99   2              T4T3M |= 0xCC;
  100   2          }
  101   1          
  102   1      //1100 1100 ¶¨Ê±Æ÷4¿ªÊ¼¼ÆÊý  ¶¨Ê±Æ÷4¼ÆÊýÄ£Ê½  12·ÖÆµ  ¹Ø±ÕÊ±ÖÓÊä³ö
  103   1      //          ¶¨Ê±Æ÷3¿ªÊ¼¼ÆÊý  ¶¨Ê±Æ÷3¼ÆÊýÄ£Ê½  12·ÖÆµ  ¹Ø±ÕÊ±ÖÓÊä³ö
  104   1      
  105   1      }
  106          
  107          /*************************************************************************
  108           *  º¯ÊýÃû³Æ£ºvoid TestEncoder(void)
  109           *  ¹¦ÄÜËµÃ÷£º²âÊÔ³ÌÐò£¬OLEDÏÔÊ¾
  110           *  ²ÎÊýËµÃ÷£ºÎÞ
  111           *  º¯Êý·µ»Ø£ºÎÞ
  112           *  ÐÞ¸ÄÊ±¼ä£º2024Äê11ÔÂ15ÈÕ
  113           *  ±¸    ×¢£º
  114           *************************************************************************/
  115          
  116          void Test_Encoder(void)
  117          {
  118   1          char txt[16];
  119   1          short duty = 20;
  120   1          
  121   1          GPIO_LED_Init();
  122   1          OLED_Init();
C251 COMPILER V5.60.0,  LQ_Encoder                                                         18/11/25  13:07:47  PAGE 3   

  123   1          OLED_CLS();                                         //ÇåÆÁ
  124   1          OLED_P6x8Str(0, 0, "Test Encoder");        //×Ö·û´®ÏÔÊ¾
  125   1          Timer_EncInit(Timer3|Timer4);               //Á½¸ö·½Ïò±àÂëÆ÷½Ó¿Ú³õÊ¼»¯£¬ ¶¨Ê±Æ÷3/4×öÂö³å¼ÆÊýÊäÈë£¬¹Ü½
             -Å¹Ì¶¨
  126   1          Global_IRQ_Enable();
  127   1          
  128   1      //    Motor_Init();         //Èç¹û¼ì²â£¬µç»ú×ª¶¯Çé¿öÏÂ±àÂëÆ÷µÄ¶ÁÈ¡Çé¿ö£¬¿ÉÒÔÅäºÏÈ¥µôÏÂÃæÓÐ¹Øµç»úµÄ×¢ÊÍ
  129   1          while (1)
  130   1          {
  131   2      //        if (KEY_Read(KEY0) == 0)      //°´ÏÂKEY0¼ü£¬Õ¼¿Õ±È¼õÐ¡
  132   2      //        {
  133   2      //            if (duty > -3600) 
  134   2      //                duty -= 50;
  135   2      //        }
  136   2      //        if (KEY_Read(KEY2) == 0)      //°´ÏÂKEY2¼ü£¬Õ¼¿Õ±È¼Ó´ó
  137   2      //        {
  138   2      //            if (duty < 3600)
  139   2      //                duty += 50;
  140   2      //        }
  141   2      //        if (KEY_Read(KEY1) == 0)      //°´ÏÂKEY1¼ü£¬Õ¼¿Õ±ÈÖÐÖµ
  142   2      //        {
  143   2      //            duty = 20;
  144   2      //        }
  145   2      //        Motor_Ctrl(duty,duty);
  146   2      
  147   2              /* »ñÈ¡±àÂëÆ÷Öµ */
  148   2              
  149   2              sprintf(txt, "Enc1: %04d  ", Read_Encoder(Enc_1));//×óµç»ú Ä¸°åÉÏ±àÂëÆ÷1£¬Ð¡³µÇ°½øÎª¸ºÖµ
  150   2              OLED_P6x8Str(0, 3, txt);                                //×Ö·û´®ÏÔÊ¾
  151   2      //        sprintf(txt, "PWM: %05d;", duty);
  152   2      //        OLED_P6x8Str(0, 4, txt);   //×Ö·û´®ÏÔÊ¾
  153   2              sprintf(txt, "Enc2: %04d  ", Read_Encoder(Enc_2));//ÓÒµç»ú Ä¸°åÉÏ±àÂëÆ÷2£¬Ð¡³µÇ°½øÎªÕýÖµ
  154   2              OLED_P6x8Str(0, 5, txt);                                //×Ö·û´®ÏÔÊ¾
  155   2      
  156   2              LED_Ctrl(LED0, RVS);                            //µçÆ½·­×ª,LEDÉÁË¸
  157   2              delay_ms(100);                                                     //ÑÓÊ±µÈ´ý
  158   2          }
  159   1      
  160   1      }
  161          
  162          
*** WARNING C183 IN LINE 119 OF ..\lq_libraries\LQ_LIB\Src\LQ_Encoder.c: dead assignment eliminated


Module Information          Static   Overlayable
------------------------------------------------
  code size            =       332     ------
  ecode size           =    ------     ------
  data size            =    ------     ------
  idata size           =    ------     ------
  pdata size           =    ------     ------
  xdata size           =    ------         16
  xdata-const size     =    ------     ------
  edata size           =    ------     ------
  bit size             =    ------     ------
  ebit size            =    ------     ------
  bitaddressable size  =    ------     ------
  ebitaddressable size =    ------     ------
  far data size        =    ------     ------
  huge data size       =    ------     ------
  const size           =    ------     ------
  hconst size          =        39     ------
End of Module Information.


C251 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)
