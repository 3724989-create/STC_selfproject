C251 COMPILER V5.60.0,  LQ_SPI_Gyro                                                        18/11/25  13:12:29  PAGE 1   


C251 COMPILER V5.60.0, COMPILATION OF MODULE LQ_SPI_Gyro
OBJECT MODULE PLACED IN .\out_file\LQ_SPI_Gyro.obj
COMPILER INVOKED BY: D:\MDK\C251\BIN\C251.EXE ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c LARGE NOALIAS FLOAT64 WARNINGLEVE
                    -L(3) OPTIMIZE(SIZE) BROWSE INCDIR(..\..\libraries\zf_common;..\..\libraries\zf_components;..\..\libraries\zf_device;..\.
                    -.\libraries\zf_driver;..\user;..\code;..\Hardware;..\lq_libraries\LQ_LIB\Inc;..\lq_libraries\Include;..\lq_libraries\Dri
                    -ver\Inc) DEBUG PRINT(.\out_file\LQ_SPI_Gyro.lst) OBJECT(.\out_file\LQ_SPI_Gyro.obj) 

stmt  level    source

    1          /*LLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLL
    2           【平    台】北京龙邱智能科技STC32位核心板
    3           【编    写】龙邱科技
    4           【E-mail  】chiusir@163.com
    5           【软件版本】V1.0 版权所有，单位使用请先联系授权
    6           【相关信息参考下列地址】
    7           【网    站】http://www.lqist.cn
    8           【淘宝店铺】http://longqiu.taobao.com
    9           --------------------------------------------------------------------------------
   10           【  IDE  】 keil C251 V5.60
   11           【Target 】 STC32G/STC8051U/AI8051U 32位模式
   12           【SYS CLK】 42 MHz使用内部晶振
   13          QQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQ*/
   14          
   15          #include "LQ_SPI_Gyro.h"
   16          
   17          
   18          // 陀螺仪初始化函数
   19          // 初始化陀螺仪只需要调用此函数即可
   20          void Gyro_SPI_Init(void)
   21          {
   22   1      #ifdef USE_HAL_SPI
               //    SPIM_Init(SPI1, baud_4500K, GYRO_SCK_PIN, GYRO_SDO_PIN, GYRO_SDI_PIN, PA15);
               
               //    Gyro_Check();
               //    if (Gyro_Parameter_Set())
               //    {
               //        LCD_ShowStr_16(3, 1, "Test Fail", u16RED, u16BLACK); // 字符串显示
               //        while (1)
               //            ;
               //    }
               #else           //USE_SOFT_SPI
   33   1          
   34   1         Soft_SPI_Init();
   35   1      
   36   1      #endif      //USE_HAL_SPI  or USE_SOFT_SPI
   37   1      
   38   1      }
   39          
   40          // 向寄存器中读取数值
   41          unsigned char SPI_Gyro_read_reg(unsigned char reg)
   42          {
   43   1          unsigned char buff1, buff2;
   44   1          buff1 = reg | 0x80;
   45   1          GYRO_CS_L;
*** ERROR C67 IN LINE 45 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'PA15': undefined identifier
*** WARNING C140 IN LINE 45 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'PIN_Write' undefined; assuming 'extern int PIN
             -_Write()'
   46   1          #ifdef USE_HAL_SPI
               //    SPI_Read_Array_8Bit_Add(GYRO_SPI, &buff2, buff1, 2);
                   #else
   49   1          LQ_SPI_Read(reg, 1, ID);
*** ERROR C67 IN LINE 49 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'ID': undefined identifier
*** WARNING C96 IN LINE 49 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'LQ_SPI_Read': too few actual parameters
   50   1          #endif
   51   1          GYRO_CS_H;
C251 COMPILER V5.60.0,  LQ_SPI_Gyro                                                        18/11/25  13:12:29  PAGE 2   

*** ERROR C67 IN LINE 51 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'PA15': undefined identifier
   52   1          return buff2;
   53   1      }
   54          
   55          // 向一个寄存器写数据
   56          void SPI_Gyro_write_reg(unsigned char reg, unsigned char value)
   57          {
   58   1          GYRO_CS_L;
*** ERROR C67 IN LINE 58 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'PA15': undefined identifier
   59   1          SPI_Write_8Bit_Add(GYRO_SPI, reg, value);
*** ERROR C67 IN LINE 59 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'GYRO_SPI': undefined identifier
*** WARNING C140 IN LINE 59 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'SPI_Write_8Bit_Add' undefined; assuming 'exter
             -n int SPI_Write_8Bit_Add()'
   60   1          GYRO_CS_H;
*** ERROR C67 IN LINE 60 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'PA15': undefined identifier
   61   1      }
   62          
   63          // 从reg寄存器开始取数据，读的长度为len，保存在buf中
   64          void SPI_Gyro_Read_Len(unsigned char reg, unsigned char len, unsigned char *buf)
   65          {
   66   1          GYRO_CS_L;
*** ERROR C67 IN LINE 66 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'PA15': undefined identifier
   67   1          SPI_Read_Array_8Bit_Add(GYRO_SPI, buf, reg | 0x80, len);
*** ERROR C67 IN LINE 67 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'GYRO_SPI': undefined identifier
*** WARNING C140 IN LINE 67 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'SPI_Read_Array_8Bit_Add' undefined; assuming '
             -extern int SPI_Read_Array_8Bit_Add()'
   68   1          GYRO_CS_H;
*** ERROR C67 IN LINE 68 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'PA15': undefined identifier
   69   1      }
   70          
   71          // 9轴陀螺仪地磁计的寄存器写数据
   72          uint8_t SPI_Mag_Write_Reg(uint8_t addr, uint8_t datax)
   73          {
   74   1          uint32_t count = 0;
   75   1          SPI_Gyro_write_reg(0x17, 0x00);
   76   1          SPI_Gyro_write_reg(0x15, 0x38);
   77   1          SPI_Gyro_write_reg(0x16, addr);
   78   1          SPI_Gyro_write_reg(0x21, datac);
*** ERROR C67 IN LINE 78 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'datac': undefined identifier
*** WARNING C96 IN LINE 78 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'SPI_Gyro_write_reg': too few actual parameters
   79   1          SPI_Gyro_write_reg(0x14, 0x4c);
   80   1          while ((SPI_Gyro_read_reg(0x22) & 0x80) == 0)
   81   1          {
   82   2              if (1000 < count++)
   83   2              {
   84   3                  return 1;
   85   3              }
   86   2              Delay_Us(100);
*** WARNING C140 IN LINE 86 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'Delay_Us' undefined; assuming 'extern int Dela
             -y_Us()'
*** WARNING C95 IN LINE 86 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'Delay_Us': too many actual parameters
   87   2          }
   88   1          return 0;
   89   1      }
*** WARNING C47 IN LINE 72 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'datax': unreferenced parameter
   90          
   91          // 向9轴陀螺仪地磁计的寄存器读数据
   92          uint8_t SPI_Mag_Read_Reg(uint8_t addr)
   93          {
   94   1          uint16_t count = 0;
   95   1          SPI_Gyro_write_reg(0x17, 0x01);
   96   1          SPI_Gyro_write_reg(0x15, 0x39);
   97   1          SPI_Gyro_write_reg(0x16, addr);
   98   1          SPI_Gyro_write_reg(0x14, 0x4c);
   99   1          while ((SPI_Gyro_read_reg(0x22) & 0x01) == 0)
  100   1          {
C251 COMPILER V5.60.0,  LQ_SPI_Gyro                                                        18/11/25  13:12:29  PAGE 3   

  101   2              if (1000 < count++)
  102   2              {
  103   3                  break;
  104   3              }
  105   2              Delay_Us(100);
*** WARNING C95 IN LINE 105 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'Delay_Us': too many actual parameters
  106   2          }
  107   1          return SPI_Gyro_read_reg(0x02);
  108   1      }
  109          
  110          // 6轴陀螺仪LSM6DSR和九轴陀螺仪LQ9AGMV的检测
  111          uint8_t Gyro_LSM6DSR_LQ9AGMV_Check(void)
  112          {
  113   1          uint8_t res;
  114   1          SPI_Gyro_write_reg(LSM6DSR_FUNC_CFG, 0x00); // 主IIC操作
  115   1          SPI_Gyro_write_reg(LSM6DSR_CTRL3_C, 0x01);
  116   1          delay_ms(2);
  117   1          SPI_Gyro_write_reg(LSM6DSR_FUNC_CFG, 0x00);
  118   1          res = SPI_Gyro_read_reg(WHO_AM_LSM6D);
  119   1          if (res == DRV_ID_LSM6D)
  120   1          {
  121   2              for (int i = 0; i <= 3; i++)
*** ERROR C25 IN LINE 121 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: syntax error near 'int'
*** ERROR C67 IN LINE 121 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'i': undefined identifier
*** ERROR C67 IN LINE 121 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'i': undefined identifier
  122   2              {
  123   3                  SPI_Gyro_write_reg(0x14, 0x80);
  124   3                  delay_ms(5);
  125   3                  SPI_Gyro_write_reg(0x14, 0x00);
  126   3                  delay_ms(5);
  127   3                  SPI_Gyro_write_reg(LSM6DSR_CTRL1_XL, 0X20);
  128   3                  SPI_Gyro_write_reg(LSM6DSR_FUNC_CFG, 0x40);
  129   3                  if (SPI_Mag_Read_Reg(0x0f) == Mag_ID)
  130   3                  {
  131   4                      res = Mag_ID;
  132   4                      break;
  133   4                  }
  134   3              }
  135   2              SPI_Gyro_write_reg(LSM6DSR_FUNC_CFG, 0x00);
  136   2          }
  137   1      
  138   1          return res;
  139   1      }
  140          
  141          // 陀螺仪型号检测
  142          uint8_t Gyro_Check(void)
  143          {
  144   1          unsigned char res;
  145   1          char txt[50] = {0};
  146   1          res = SPI_Gyro_read_reg(WHO_AM_I); // 读取ICM20602的ID
  147   1          switch (res)
  148   1          {
  149   2          case 0x12:
  150   2              GyroType = SPI_ICM20602;
  151   2              break;
  152   2          case 0x71:
  153   2              GyroType = SPI_MPU9250;
  154   2              break;
  155   2          case 0x98:
  156   2              GyroType = SPI_ICM20689;
  157   2              break;
  158   2          case 0x42:
  159   2              GyroType = SPI_ICM42605;
  160   2              break;
  161   2          default:
  162   2              res = Gyro_LSM6DSR_LQ9AGMV_Check();
C251 COMPILER V5.60.0,  LQ_SPI_Gyro                                                        18/11/25  13:12:29  PAGE 4   

  163   2              if (res == DRV_ID_LSM6D)
  164   2                  GyroType = SPI_LSM6DSR;
  165   2              else if (res == Mag_ID)
  166   2                  GyroType = SPI_LQ9AGMV;
  167   2              else
  168   2                  GyroType = error;
  169   2              break;
  170   2          }
  171   1          switch (GyroType)
  172   1          {
  173   2          case SPI_ICM20602:
  174   2              LCD_ShowStr_16(0, 0, "LQ 20602 Test", u16RED, u16BLACK);
*** ERROR C67 IN LINE 174 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'u16RED': undefined identifier
*** ERROR C67 IN LINE 174 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'u16BLACK': undefined identifier
*** WARNING C96 IN LINE 174 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'LCD_ShowStr_16': too few actual parameters
  175   2              break; // 字符串显示
  176   2          case SPI_ICM20689:
  177   2              LCD_ShowStr_16(0, 0, "LQ 20689 Test", u16RED, u16BLACK);
*** ERROR C67 IN LINE 177 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'u16RED': undefined identifier
*** ERROR C67 IN LINE 177 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'u16BLACK': undefined identifier
*** WARNING C96 IN LINE 177 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'LCD_ShowStr_16': too few actual parameters
  178   2              break; // 字符串显示
  179   2          case SPI_MPU9250:
  180   2              LCD_ShowStr_16(0, 0, "LQ 9250 Test", u16RED, u16BLACK);
*** ERROR C67 IN LINE 180 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'u16RED': undefined identifier
*** ERROR C67 IN LINE 180 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'u16BLACK': undefined identifier
*** WARNING C96 IN LINE 180 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'LCD_ShowStr_16': too few actual parameters
  181   2              break; // 字符串显示
  182   2          case SPI_ICM42605:
  183   2              LCD_ShowStr_16(0, 0, "LQ 42605 Test", u16RED, u16BLACK);
*** ERROR C67 IN LINE 183 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'u16RED': undefined identifier
*** ERROR C67 IN LINE 183 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'u16BLACK': undefined identifier
*** WARNING C96 IN LINE 183 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'LCD_ShowStr_16': too few actual parameters
  184   2              break; // 字符串显示
  185   2          case SPI_LSM6DSR:
  186   2              LCD_ShowStr_16(0, 0, "LQ LSM6DSR Test", u16RED, u16BLACK);
*** ERROR C67 IN LINE 186 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'u16RED': undefined identifier
*** ERROR C67 IN LINE 186 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'u16BLACK': undefined identifier
*** WARNING C96 IN LINE 186 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'LCD_ShowStr_16': too few actual parameters
  187   2              break; // 字符串显示
  188   2          case SPI_LQ9AGMV:
  189   2              LCD_ShowStr_16(0, 0, "LQ LQ9AGMV Test", u16RED, u16BLACK);
*** ERROR C67 IN LINE 189 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'u16RED': undefined identifier
*** ERROR C67 IN LINE 189 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'u16BLACK': undefined identifier
*** WARNING C96 IN LINE 189 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'LCD_ShowStr_16': too few actual parameters
  190   2              break; // 字符串显示
  191   2          case error:
  192   2              sprintf(txt, "Gyro rec fail:%x", res);
  193   2              LCD_ShowStr_16(0, 0, txt, u16RED, u16BLACK);
*** ERROR C67 IN LINE 193 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'u16RED': undefined identifier
*** ERROR C67 IN LINE 193 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'u16BLACK': undefined identifier
*** WARNING C96 IN LINE 193 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'LCD_ShowStr_16': too few actual parameters
  194   2              while (1)
  195   2                  ;
  196   2          }
  197   1          return res;
  198   1      }
  199          
  200          // 陀螺仪初始化参数设置
  201          uint8_t Gyro_Parameter_Set(void)
  202          {
  203   1          uint8_t res;
  204   1          if (GyroType == SPI_MPU9250)
  205   1              return 0;
  206   1          if (GyroType == SPI_ICM42605)
  207   1          {
C251 COMPILER V5.60.0,  LQ_SPI_Gyro                                                        18/11/25  13:12:29  PAGE 5   

  208   2              GYRO_CS_L;
*** ERROR C67 IN LINE 208 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'PA15': undefined identifier
  209   2              SPI_Gyro_write_reg(reg_bank_sel, 0x00);                            // Set to bank 0
*** ERROR C67 IN LINE 209 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'reg_bank_sel': undefined identifier
*** WARNING C96 IN LINE 209 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'SPI_Gyro_write_reg': too few actual parameters
  210   2              SPI_Gyro_write_reg(reg_bank_sel, 0x00);                            // Set to bank 0
*** ERROR C67 IN LINE 210 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'reg_bank_sel': undefined identifier
*** WARNING C96 IN LINE 210 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'SPI_Gyro_write_reg': too few actual parameters
  211   2              SPI_Gyro_write_reg(device_config_reg, bit_soft_reset_chip_config); // chip soft reset
*** ERROR C67 IN LINE 211 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'device_config_reg': undefined identifier
*** ERROR C67 IN LINE 211 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'bit_soft_reset_chip_config': undefined identifie
             -r
*** WARNING C96 IN LINE 211 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'SPI_Gyro_write_reg': too few actual parameters
  212   2              delay_ms(100);
  213   2      
  214   2              SPI_Gyro_write_reg(reg_bank_sel, 0x01); // Change to bank 1
*** ERROR C67 IN LINE 214 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'reg_bank_sel': undefined identifier
*** WARNING C96 IN LINE 214 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'SPI_Gyro_write_reg': too few actual parameters
  215   2              SPI_Gyro_write_reg(intf_config4, 0x02); // 4 wire spi mode
*** ERROR C67 IN LINE 215 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'intf_config4': undefined identifier
*** WARNING C96 IN LINE 215 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'SPI_Gyro_write_reg': too few actual parameters
  216   2              SPI_Gyro_write_reg(reg_bank_sel, 0x00);
*** ERROR C67 IN LINE 216 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'reg_bank_sel': undefined identifier
*** WARNING C96 IN LINE 216 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'SPI_Gyro_write_reg': too few actual parameters
  217   2              SPI_Gyro_write_reg(fifo_config_reg, 0x40); // Stream-to-FIFO Mode
*** ERROR C67 IN LINE 217 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'fifo_config_reg': undefined identifier
*** WARNING C96 IN LINE 217 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'SPI_Gyro_write_reg': too few actual parameters
  218   2      
  219   2              res = SPI_Gyro_read_reg(int_source0_reg);
*** ERROR C67 IN LINE 219 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'int_source0_reg': undefined identifier
*** WARNING C96 IN LINE 219 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'SPI_Gyro_read_reg': too few actual parameters
  220   2              SPI_Gyro_write_reg(int_source0_reg, 0x00);
*** ERROR C67 IN LINE 220 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'int_source0_reg': undefined identifier
*** WARNING C96 IN LINE 220 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'SPI_Gyro_write_reg': too few actual parameters
  221   2              SPI_Gyro_write_reg(fifo_config2_reg, 0x00); // watermark
*** ERROR C67 IN LINE 221 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'fifo_config2_reg': undefined identifier
*** WARNING C96 IN LINE 221 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'SPI_Gyro_write_reg': too few actual parameters
  222   2              SPI_Gyro_write_reg(fifo_config3_reg, 0x02); // watermark
*** ERROR C67 IN LINE 222 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'fifo_config3_reg': undefined identifier
*** WARNING C96 IN LINE 222 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'SPI_Gyro_write_reg': too few actual parameters
  223   2              SPI_Gyro_write_reg(int_source0_reg, res);
*** ERROR C67 IN LINE 223 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'int_source0_reg': undefined identifier
*** WARNING C96 IN LINE 223 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'SPI_Gyro_write_reg': too few actual parameters
  224   2              SPI_Gyro_write_reg(fifo_config1_reg, 0x63); // Enable the accel and gyro to the FIFO
*** ERROR C67 IN LINE 224 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'fifo_config1_reg': undefined identifier
*** WARNING C96 IN LINE 224 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'SPI_Gyro_write_reg': too few actual parameters
  225   2      
  226   2              SPI_Gyro_write_reg(reg_bank_sel, 0x00);
*** ERROR C67 IN LINE 226 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'reg_bank_sel': undefined identifier
*** WARNING C96 IN LINE 226 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'SPI_Gyro_write_reg': too few actual parameters
  227   2              SPI_Gyro_write_reg(int_config_reg, 0x36);
*** ERROR C67 IN LINE 227 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'int_config_reg': undefined identifier
*** WARNING C96 IN LINE 227 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'SPI_Gyro_write_reg': too few actual parameters
  228   2      
  229   2              SPI_Gyro_write_reg(reg_bank_sel, 0x00);
*** ERROR C67 IN LINE 229 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'reg_bank_sel': undefined identifier
*** WARNING C96 IN LINE 229 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'SPI_Gyro_write_reg': too few actual parameters
  230   2              res = (SPI_Gyro_read_reg(int_source0_reg) | bit_int_fifo_ths_int1_en);
*** ERROR C67 IN LINE 230 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'int_source0_reg': undefined identifier
*** ERROR C67 IN LINE 230 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'bit_int_fifo_ths_int1_en': undefined identifier
  231   2              SPI_Gyro_write_reg(int_source0_reg, res);
*** ERROR C67 IN LINE 231 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'int_source0_reg': undefined identifier
*** WARNING C96 IN LINE 231 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'SPI_Gyro_write_reg': too few actual parameters
  232   2      
  233   2              SPI_Gyro_write_reg(reg_bank_sel, 0x00);
*** ERROR C67 IN LINE 233 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'reg_bank_sel': undefined identifier
C251 COMPILER V5.60.0,  LQ_SPI_Gyro                                                        18/11/25  13:12:29  PAGE 6   

*** WARNING C96 IN LINE 233 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'SPI_Gyro_write_reg': too few actual parameters
  234   2              res = ((SPI_Gyro_read_reg(accel_config0_reg) & 0x1F) | (bit_accel_ui_fs_sel_8g)); // 8g
*** ERROR C67 IN LINE 234 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'accel_config0_reg': undefined identifier
*** ERROR C67 IN LINE 234 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'bit_accel_ui_fs_sel_8g': undefined identifier
  235   2              SPI_Gyro_write_reg(accel_config0_reg, res);
*** ERROR C67 IN LINE 235 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'accel_config0_reg': undefined identifier
*** WARNING C96 IN LINE 235 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'SPI_Gyro_write_reg': too few actual parameters
  236   2      
  237   2              SPI_Gyro_write_reg(reg_bank_sel, 0x00);
*** ERROR C67 IN LINE 237 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'reg_bank_sel': undefined identifier
*** WARNING C96 IN LINE 237 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'SPI_Gyro_write_reg': too few actual parameters
  238   2              res = ((SPI_Gyro_read_reg(accel_config0_reg) & 0xF0) | bit_accel_odr_50hz);
*** ERROR C67 IN LINE 238 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'accel_config0_reg': undefined identifier
*** ERROR C67 IN LINE 238 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'bit_accel_odr_50hz': undefined identifier
  239   2              SPI_Gyro_write_reg(accel_config0_reg, res);
*** ERROR C67 IN LINE 239 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'accel_config0_reg': undefined identifier
*** WARNING C96 IN LINE 239 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'SPI_Gyro_write_reg': too few actual parameters
  240   2      
  241   2              SPI_Gyro_write_reg(reg_bank_sel, 0x00);
*** ERROR C67 IN LINE 241 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'reg_bank_sel': undefined identifier
*** WARNING C96 IN LINE 241 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'SPI_Gyro_write_reg': too few actual parameters
  242   2              res = ((SPI_Gyro_read_reg(gyro_config0_reg) & 0x1F) | (bit_gyro_ui_fs_sel_1000dps));
*** ERROR C67 IN LINE 242 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'gyro_config0_reg': undefined identifier
*** ERROR C67 IN LINE 242 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'bit_gyro_ui_fs_sel_1000dps': undefined identifie
             -r
  243   2              SPI_Gyro_write_reg(gyro_config0_reg, res);
*** ERROR C67 IN LINE 243 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'gyro_config0_reg': undefined identifier
*** WARNING C96 IN LINE 243 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'SPI_Gyro_write_reg': too few actual parameters
  244   2      
  245   2              SPI_Gyro_write_reg(reg_bank_sel, 0x00);
*** ERROR C67 IN LINE 245 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'reg_bank_sel': undefined identifier
*** WARNING C96 IN LINE 245 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'SPI_Gyro_write_reg': too few actual parameters
  246   2              res = ((SPI_Gyro_read_reg(gyro_config0_reg) & 0xF0) | bit_gyro_odr_50hz);
*** ERROR C67 IN LINE 246 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'gyro_config0_reg': undefined identifier
*** ERROR C67 IN LINE 246 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'bit_gyro_odr_50hz': undefined identifier
  247   2              SPI_Gyro_write_reg(gyro_config0_reg, res);
*** ERROR C67 IN LINE 247 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'gyro_config0_reg': undefined identifier
*** WARNING C96 IN LINE 247 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'SPI_Gyro_write_reg': too few actual parameters
  248   2      
  249   2              SPI_Gyro_write_reg(reg_bank_sel, 0x00);
*** ERROR C67 IN LINE 249 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'reg_bank_sel': undefined identifier
*** WARNING C96 IN LINE 249 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'SPI_Gyro_write_reg': too few actual parameters
  250   2              res = SPI_Gyro_read_reg(pwr_mgmt0_reg) | (bit_accel_mode_ln); // Accel on in LNM
*** ERROR C67 IN LINE 250 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'pwr_mgmt0_reg': undefined identifier
*** ERROR C67 IN LINE 250 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'bit_accel_mode_ln': undefined identifier
  251   2              SPI_Gyro_write_reg(pwr_mgmt0_reg, res);
*** ERROR C67 IN LINE 251 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'pwr_mgmt0_reg': undefined identifier
*** WARNING C96 IN LINE 251 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'SPI_Gyro_write_reg': too few actual parameters
  252   2              delay_ms(1);
  253   2      
  254   2              SPI_Gyro_write_reg(reg_bank_sel, 0x00);
*** ERROR C67 IN LINE 254 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'reg_bank_sel': undefined identifier
*** WARNING C96 IN LINE 254 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'SPI_Gyro_write_reg': too few actual parameters
  255   2              res = SPI_Gyro_read_reg(pwr_mgmt0_reg) | (bit_gyro_mode_ln); // Gyro on in LNM
*** ERROR C67 IN LINE 255 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'pwr_mgmt0_reg': undefined identifier
*** ERROR C67 IN LINE 255 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'bit_gyro_mode_ln': undefined identifier
  256   2              SPI_Gyro_write_reg(pwr_mgmt0_reg, res);
*** ERROR C67 IN LINE 256 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'pwr_mgmt0_reg': undefined identifier
*** WARNING C96 IN LINE 256 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'SPI_Gyro_write_reg': too few actual parameters
  257   2              GYRO_CS_H;
*** ERROR C67 IN LINE 257 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'PA15': undefined identifier
  258   2              delay_ms(1);
  259   2              return 0;
  260   2          }
  261   1          else if ((GyroType == SPI_LSM6DSR) || (GyroType == SPI_LQ9AGMV))
  262   1          {
C251 COMPILER V5.60.0,  LQ_SPI_Gyro                                                        18/11/25  13:12:29  PAGE 7   

  263   2              GYRO_CS_L;
*** ERROR C67 IN LINE 263 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'PA15': undefined identifier
  264   2              SPI_Gyro_write_reg(LSM6DSR_CTRL1_XL, 0X20);       // 加速度计52HZ（倾斜角检测功能工作在26HZ，因此
             -加速度计ODR必须设置为>=26hz）,2g量程。
  265   2              SPI_Gyro_write_reg(LSM6DSR_CTRL9_XL, 0X38);       // 使能加速度计x,y,z轴
  266   2              SPI_Gyro_write_reg(LSM6DSR_CTRL6_C, 0X40 | 0x10); // 陀螺仪电平触发，加速度计高性能使能
  267   2              SPI_Gyro_write_reg(LSM6DSR_CTRL7_G, 0X80);        // 陀螺仪高性能使能
  268   2              SPI_Gyro_write_reg(LSM6DSR_INT2_CTRL, 0X03);      // 加速度计INT2引脚失能,陀螺仪数据INT2使能
  269   2              SPI_Gyro_write_reg(LSM6DSR_CTRL2_G, 0X1C);        // 陀螺仪12.5hz  2000dps
  270   2              SPI_Gyro_write_reg(LSM6DSR_CTRL10_C, 0X38);       // 使能陀螺仪x,y,z轴
  271   2              if (GyroType == SPI_LQ9AGMV)
  272   2              {
  273   3                  SPI_Gyro_write_reg(LSM6DSR_FUNC_CFG, 0x40);
  274   3                  SPI_Gyro_write_reg(0x14, 0x80);
  275   3                  delay_ms(1);
  276   3                  SPI_Gyro_write_reg(0x14, 0x00);
  277   3                  delay_ms(1);
  278   3                  SPI_Mag_Write_Reg(0x21, 0x04); // 陀螺仪复位
  279   3                  delay_ms(5);
  280   3                  SPI_Mag_Write_Reg(0x21, 0x00);
  281   3                  delay_ms(5);
  282   3                  SPI_Mag_Write_Reg(0x20, 0x7f);
  283   3                  SPI_Mag_Write_Reg(0x23, 0x0c);
  284   3                  SPI_Mag_Write_Reg(0x22, 0x00);
  285   3                  SPI_Mag_Write_Reg(0x24, 0x00);
  286   3                  SPI_Mag_Write_Reg(0x30, 0x02);
  287   3                  SPI_Gyro_write_reg(0x17, 0x06);
  288   3                  SPI_Gyro_write_reg(0x15, 0x39);
  289   3                  SPI_Gyro_write_reg(0x16, 0x28);
  290   3                  SPI_Gyro_write_reg(0x14, 0x4c);
  291   3                  while ((SPI_Gyro_read_reg(0x22) & 0x01) == 0)
  292   3                      ;
  293   3                  SPI_Gyro_write_reg(0x14, 0x6c);
  294   3                  SPI_Gyro_write_reg(LSM6DSR_FUNC_CFG, 0x00);
  295   3              }
  296   2              GYRO_CS_H;
*** ERROR C67 IN LINE 296 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'PA15': undefined identifier
  297   2              return 0;
  298   2          }
  299   1          else
  300   1          {
  301   2              GYRO_CS_L;
*** ERROR C67 IN LINE 301 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'PA15': undefined identifier
  302   2              SPI_Gyro_write_reg(ICM_PWR_MGMT1_REG, 0X80);   // 复位ICM20602
  303   2              delay_ms(100);                                 // 延时100ms
  304   2              SPI_Gyro_write_reg(ICM_PWR_MGMT1_REG, 0X00);   // 唤醒ICM20602
  305   2              SPI_Gyro_write_reg(ICM_GYRO_CFG_REG, 3 << 3);  // 陀螺仪传感器,±2000dps
  306   2              SPI_Gyro_write_reg(ICM_ACCEL_CFG_REG, 1 << 3); // 加速度传感器,±4g
  307   2              SPI_Gyro_write_reg(ICM_SAMPLE_RATE_REG, 0X00); // 设置数字低通滤波器
  308   2              SPI_Gyro_write_reg(ICM_CFG_REG, 0X01);         // 设置采样率1000Hz
  309   2              SPI_Gyro_write_reg(ICM_CFG_REG, 0X02);         // 设置数字低通滤波器   98hz
  310   2              SPI_Gyro_write_reg(ICM_INT_EN_REG, 0X00);      // 关闭所有中断
  311   2              SPI_Gyro_write_reg(ICM_USER_CTRL_REG, 0X00);   // I2C主模式关闭
  312   2              SPI_Gyro_write_reg(ICM_PWR_MGMT1_REG, 0X01);   // 设置CLKSEL,PLL X轴为参考
  313   2              SPI_Gyro_write_reg(ICM_PWR_MGMT2_REG, 0X00);   // 加速度与陀螺仪都工作
  314   2              GYRO_CS_H;
*** ERROR C67 IN LINE 314 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'PA15': undefined identifier
  315   2              return 0;
  316   2          }
  317   1      
  318   1          return 1;
  319   1      }
  320          
  321          
  322          
  323          // 读取陀螺仪的角速度值
C251 COMPILER V5.60.0,  LQ_SPI_Gyro                                                        18/11/25  13:12:29  PAGE 8   

  324          void Gyro_SPI_Read_acc(short *accx, short *accy, short *accz)
  325          {
  326   1          unsigned char buf[6];
  327   1          if (GyroType == SPI_ICM42605)
  328   1          {
  329   2              SPI_Gyro_Read_Len(ICM_ACCEL_DATA_X1, 6, buf);
  330   2              *accx = (short)(((uint16_t)buf[0] << 8) | buf[1]);
  331   2              *accy = (short)(((uint16_t)buf[2] << 8) | buf[3]);
  332   2              *accz = (short)(((uint16_t)buf[4] << 8) | buf[5]);
  333   2          }
  334   1          else if ((GyroType == SPI_LSM6DSR) || (GyroType == SPI_LQ9AGMV))
  335   1          {
  336   2              SPI_Gyro_Read_Len(LSM6DSR_OUTX_L_ACC, 6, buf);
  337   2              *accx = (short)(((uint16_t)buf[1] << 8) | buf[0]);
  338   2              *accy = (short)(((uint16_t)buf[3] << 8) | buf[2]);
  339   2              *accz = (short)(((uint16_t)buf[5] << 8) | buf[4]);
  340   2          }
  341   1          else
  342   1          {
  343   2              SPI_Gyro_Read_Len(0x3b, 6, buf);
  344   2              *accx = (short)(((uint16_t)buf[0] << 8) | buf[1]);
  345   2              *accy = (short)(((uint16_t)buf[2] << 8) | buf[3]);
  346   2              *accz = (short)(((uint16_t)buf[4] << 8) | buf[5]);
  347   2          }
  348   1      }
  349          
  350          // 读取陀螺仪的重力加速度
  351          void Gyro_SPI_Read_gyro(short *gyrox, short *gyroy, short *gyroz)
  352          {
  353   1          unsigned char buf[6];
  354   1          if (GyroType == SPI_ICM42605)
  355   1          {
  356   2              SPI_Gyro_Read_Len(ICM_GYRO_DATA_X1, 6, buf);
  357   2              *gyrox = (short)(((uint16_t)buf[0] << 8) | buf[1]);
  358   2              *gyroy = (short)(((uint16_t)buf[2] << 8) | buf[3]);
  359   2              *gyroz = (short)(((uint16_t)buf[4] << 8) | buf[5]);
  360   2          }
  361   1          else if ((GyroType == SPI_LSM6DSR) || (GyroType == SPI_LQ9AGMV))
  362   1          {
  363   2              SPI_Gyro_Read_Len(LSM6DSR_OUTX_L_GYRO, 6, buf);
  364   2              *gyrox = (short)(((uint16_t)buf[1] << 8) | buf[0]);
  365   2              *gyroy = (short)(((uint16_t)buf[3] << 8) | buf[2]);
  366   2              *gyroz = (short)(((uint16_t)buf[5] << 8) | buf[4]);
  367   2          }
  368   1          else
  369   1          {
  370   2              SPI_Gyro_Read_Len(0x3b + 8, 6, buf);
  371   2              *gyrox = (short)(((uint16_t)buf[0] << 8) | buf[1]);
  372   2              *gyroy = (short)(((uint16_t)buf[2] << 8) | buf[3]);
  373   2              *gyroz = (short)(((uint16_t)buf[4] << 8) | buf[5]);
  374   2          }
  375   1      }
  376          // 读取9轴陀螺仪LQ9AGMV的3轴磁力计
  377          void Gyro_Get_Mag_data(short *magx, short *magy, short *magz)
  378          {
  379   1          unsigned char buf[6];
  380   1          if (GyroType == SPI_LQ9AGMV)
  381   1          {
  382   2              SPI_Gyro_write_reg(LSM6DSR_FUNC_CFG, 0x40);
  383   2              SPI_Gyro_Read_Len(0x02, 6, buf);
  384   2              *magx = (short)(((uint16_t)buf[1] << 8) | buf[0]);
  385   2              *magy = (short)(((uint16_t)buf[3] << 8) | buf[2]);
  386   2              *magz = (short)(((uint16_t)buf[5] << 8) | buf[4]);
  387   2              SPI_Gyro_write_reg(LSM6DSR_FUNC_CFG, 0x00);
  388   2          }
  389   1      }
C251 COMPILER V5.60.0,  LQ_SPI_Gyro                                                        18/11/25  13:12:29  PAGE 9   

  390          
  391          
  392          /*****************************************************************************************
  393           * 函 数 名： void Gyro_Get_Raw_data(short *ax, short *ay, short *az, short *gx, short *gy, short *gz)
  394           * 函数功能：同时读取陀螺仪的重力加速度和角速度
  395           * 输入参数： ax, ay, az, gx, gy, gz 返回数据的指针
  396           * 返 回 值： 无
  397           * 调用示例： Gyro_Get_Raw_data(&ax, &ay, &az, &gx, &gy, &gz);
  398           * 注意事项： 无
  399           * ***************************************************************************************/
  400          void Gyro_Get_Raw_data(short *ax, short *ay, short *az, short *gx, short *gy, short *gz)
  401          {
  402   1          unsigned char buf[15];
  403   1          if (GyroType == SPI_ICM42605)
  404   1          {
  405   2              SPI_Gyro_Read_Len(ICM_ACCEL_DATA_X1, 12, buf);
  406   2              *ax = (short)(((uint16_t)buf[0] << 8) | buf[1]);
  407   2              *ay = (short)(((uint16_t)buf[2] << 8) | buf[3]);
  408   2              *az = (short)(((uint16_t)buf[4] << 8) | buf[5]);
  409   2              *gx = (short)(((uint16_t)buf[6] << 8) | buf[7]);
  410   2              *gy = (short)(((uint16_t)buf[8] << 8) | buf[9]);
  411   2              *gz = (short)(((uint16_t)buf[10] << 8) | buf[11]);
  412   2          }
  413   1          else if ((GyroType == SPI_LSM6DSR) || (GyroType == SPI_LQ9AGMV))
  414   1          {
  415   2              SPI_Gyro_Read_Len(LSM6DSR_OUTX_L_GYRO, 12, buf);
  416   2              *gx = (short)(((uint16_t)buf[1] << 8) | buf[0]);
  417   2              *gy = (short)(((uint16_t)buf[3] << 8) | buf[2]);
  418   2              *gz = (short)(((uint16_t)buf[5] << 8) | buf[4]);
  419   2              *ax = (short)(((uint16_t)buf[7] << 8) | buf[6]);
  420   2              *ay = (short)(((uint16_t)buf[9] << 8) | buf[8]);
  421   2              *az = (short)(((uint16_t)buf[11] << 8) | buf[10]);
  422   2          }
  423   1          else
  424   1          {
  425   2              SPI_Gyro_Read_Len(0x3b, 14, buf);
  426   2              *ax = (short)(((uint16_t)buf[0] << 8) | buf[1]);
  427   2              *ay = (short)(((uint16_t)buf[2] << 8) | buf[3]);
  428   2              *az = (short)(((uint16_t)buf[4] << 8) | buf[5]);
  429   2              *gx = (short)(((uint16_t)buf[8] << 8) | buf[9]);
  430   2              *gy = (short)(((uint16_t)buf[10] << 8) | buf[11]);
  431   2              *gz = (short)(((uint16_t)buf[12] << 8) | buf[13]);
  432   2          }
  433   1      }
  434          
  435          #ifdef USE_HAL_SPI
               /*******************************************************************************
               * 函 数 名 ：void Test_HAL_SPI_Gyro()
               * 描    述 ：硬件SPI陀螺仪测试函数
               * 输    入 ：无
               * 输    出 ：无
               * 备    注 ：
               ********************************************************************************/
               //void Test_HAL_SPI_Gyro(void)
               //{
               //    char txt[30];
               //    short accx = 0, accy = 0, accz = 0;    // 加速度传感器原始数据
               //    short gyrox = 0, gyroy = 0, gyroz = 0; // 陀螺仪原始数据
               //    short magx = 0, magy = 0, magz = 0;    // 9轴陀螺仪的磁力计原始数据
               
               //    Gyro_SPI_Init(); // SPI陀螺仪通用初始化函数 内部判断使用软件还是硬件方式
               //    
               //#ifdef USE_OLED
               //    GPIO_LED_Init();
               //    
               //    
C251 COMPILER V5.60.0,  LQ_SPI_Gyro                                                        18/11/25  13:12:29  PAGE 10  

               //#else
               //    LCD_Init(); // LCD初始化  0:横屏  1：竖屏
               //    LCD_CLS(BLACK);
               
               
               
               //    while (1)
               //    {
               //        Gyro_SPI_Read_acc(&accx, &accy, &accz);     // 读取陀螺仪角速度
               //        Gyro_SPI_Read_gyro(&gyrox, &gyroy, &gyroz); // 读取陀螺仪重力加速度
               
               //        // Gyro_Get_Raw_data(&accx,&accy,&accz,&gyrox,&gyroy,&gyroz); //同时读取角速度和加速度
               
               //        sprintf((char *)txt, "ax:%06d", accx);
               //        LCD_ShowStr_16(0, 1, txt, u16RED, u16BLACK); // 字符串显示
               //        sprintf((char *)txt, "ay:%06d", accy);
               //        LCD_ShowStr_16(0, 2, txt, u16RED, u16BLACK); // 字符串显示
               //        sprintf((char *)txt, "az:%06d", accz);
               //        LCD_ShowStr_16(0, 3, txt, u16RED, u16BLACK); // 字符串显示
               //        sprintf((char *)txt, "gx:%06d", gyrox);
               //        LCD_ShowStr_16(0, 4, txt, u16RED, u16BLACK); // 字符串显示
               //        sprintf((char *)txt, "gy:%06d", gyroy);
               //        LCD_ShowStr_16(0, 5, txt, u16RED, u16BLACK); // 字符串显示
               //        sprintf((char *)txt, "gz:%06d", gyroz);
               //        LCD_ShowStr_16(0, 6, txt, u16RED, u16BLACK); // 字符串显示
               
               //        if (GyroType == SPI_LQ9AGMV)
               //        { // 9轴陀螺仪地磁计数据读取
               //            Gyro_Get_Mag_data(&magx, &magy, &magz);
               //            sprintf((char *)txt, "mx:%06d", magx);
               //            LCD_ShowStr_16(0, 7, txt, u16RED, u16BLACK); // 字符串显示
               //            sprintf((char *)txt, "my:%06d", magy);
               //            LCD_ShowStr_16(0, 8, txt, u16RED, u16BLACK); // 字符串显示
               //            sprintf((char *)txt, "mz:%06d", magz);
               //            LCD_ShowStr_16(0, 9, txt, u16RED, u16BLACK); // 字符串显示
               //        }
               
               //        LED_Ctrl(LED0, RVS);
               //        delay_ms(10);
               //    }
               //  #endif
               //    
               //}
               
               #else  //USE_SOFT_SPI
  501          
  502          
  503          void Test_SOFT_SPI_Gyro(void)
  504           {
  505   1           signed short accelerat_X, accelerat_Y, accelerat_Z;
  506   1           signed short gyro_X, gyro_Y, gyro_Z;
  507   1           unsigned char res;
  508   1           char  txt[30];
  509   1      
  510   1           Gyro_SPI_Init();      //函数内判断宏选择硬件还是软件SPI方式
  511   1      
  512   1               delay_ms(500);
  513   1           OLED_Init();                //LCD初始化
  514   1           OLED_CLS();                 //LCD清屏
  515   1      
  516   1           res = Gyro_Chose_SPI();
*** WARNING C140 IN LINE 516 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'Gyro_Chose_SPI' undefined; assuming 'extern i
             -nt Gyro_Chose_SPI()'
  517   1           OLED_P14x16Str(8,0,(unsigned char*)"北京龙邱智能科技");            //字符串显示
  518   1           sprintf(txt,"ID:0X%2x",res);
  519   1           OLED_P6x8Str(70,2,txt);     // 字符串显示
C251 COMPILER V5.60.0,  LQ_SPI_Gyro                                                        18/11/25  13:12:29  PAGE 11  

  520   1           if(res == 0xff)
  521   1           {
  522   2               sprintf(txt,"Gyro init error",res);
  523   2               OLED_P6x8Str(5,4,txt);     // 字符串显示
  524   2               while(1);
  525   2           }
  526   1      
  527   1           Gyro_Write_Byte_SPI(ICM_PWR_MGMT1_REG,0X80);//复位
*** WARNING C140 IN LINE 527 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'Gyro_Write_Byte_SPI' undefined; assuming 'ext
             -ern int Gyro_Write_Byte_SPI()'
*** WARNING C95 IN LINE 527 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'Gyro_Write_Byte_SPI': too many actual paramete
             -rs
  528   1           delay_ms(100);  //延时100ms
  529   1           Gyro_Write_Byte_SPI(ICM_PWR_MGMT1_REG,0X00);//唤醒
*** WARNING C95 IN LINE 529 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'Gyro_Write_Byte_SPI': too many actual paramete
             -rs
  530   1           delay_ms(100);  //延时100ms
  531   1      
  532   1           Gyro_Write_Byte_SPI(ICM_GYRO_CFG_REG,3<<3);//设置陀螺仪满量程范围
*** WARNING C95 IN LINE 532 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'Gyro_Write_Byte_SPI': too many actual paramete
             -rs
  533   1           Gyro_Write_Byte_SPI(ICM_ACCEL_CFG_REG,1<<3);//设置加速度传感器满量程范围
*** WARNING C95 IN LINE 533 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'Gyro_Write_Byte_SPI': too many actual paramete
             -rs
  534   1           Gyro_Write_Byte_SPI(ICM_SAMPLE_RATE_REG,1000/999); //设置数字低通滤波器
*** WARNING C95 IN LINE 534 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'Gyro_Write_Byte_SPI': too many actual paramete
             -rs
  535   1           Gyro_Write_Byte_SPI(ICM_CFG_REG,1);//设置数字低通滤波器
*** WARNING C95 IN LINE 535 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'Gyro_Write_Byte_SPI': too many actual paramete
             -rs
  536   1           Gyro_Write_Byte_SPI(ICM_CFG_REG,0x02);      //设置数字低通滤波器   98hz
*** WARNING C95 IN LINE 536 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'Gyro_Write_Byte_SPI': too many actual paramete
             -rs
  537   1           Gyro_Write_Byte_SPI(ICM_INT_EN_REG,0X00);   //关闭所有中断
*** WARNING C95 IN LINE 537 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'Gyro_Write_Byte_SPI': too many actual paramete
             -rs
  538   1           Gyro_Write_Byte_SPI(ICM_USER_CTRL_REG,0X00);//I2C主模式关闭
*** WARNING C95 IN LINE 538 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'Gyro_Write_Byte_SPI': too many actual paramete
             -rs
  539   1           Gyro_Write_Byte_SPI(ICM_PWR_MGMT1_REG,0X01);//设置CLKSEL,PLL X轴为参考
*** WARNING C95 IN LINE 539 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'Gyro_Write_Byte_SPI': too many actual paramete
             -rs
  540   1           Gyro_Write_Byte_SPI(ICM_PWR_MGMT2_REG,0X00);//加速度与陀螺仪都工作
*** WARNING C95 IN LINE 540 OF ..\lq_libraries\LQ_LIB\Src\LQ_SPI_Gyro.c: 'Gyro_Write_Byte_SPI': too many actual paramete
             -rs
  541   1      
  542   1           while(1)
  543   1           {
  544   2               Gyro_Get_Raw_data_SPI(&accelerat_X, &accelerat_Y, &accelerat_Z, &gyro_X, &gyro_Y, &gyro_Z);
  545   2               sprintf((char*)txt,"ax:%06d",accelerat_X);
  546   2               OLED_P6x8Str(0,2,txt);
  547   2               sprintf((char*)txt,"ay:%06d",accelerat_Y);
  548   2               OLED_P6x8Str(0,3,txt);
  549   2               sprintf((char*)txt,"az:%06d",accelerat_Z);
  550   2               OLED_P6x8Str(0,4,txt);
  551   2               sprintf((char*)txt,"gx:%06d",gyro_X);
  552   2               OLED_P6x8Str(0,5,txt);
  553   2               sprintf((char*)txt,"gy:%06d",gyro_Y);
  554   2               OLED_P6x8Str(0,6,txt);
  555   2               sprintf((char*)txt,"gz:%06d",gyro_Z);
  556   2               OLED_P6x8Str(0,7,txt);
  557   2               delay_ms(20);
  558   2           }
  559   1       }
  560          
  561          
C251 COMPILER V5.60.0,  LQ_SPI_Gyro                                                        18/11/25  13:12:29  PAGE 12  

  562          #endif      //USE_HAL_SPI  or USE_SOFT_SPI

C251 COMPILATION COMPLETE.  58 WARNING(S),  77 ERROR(S)
