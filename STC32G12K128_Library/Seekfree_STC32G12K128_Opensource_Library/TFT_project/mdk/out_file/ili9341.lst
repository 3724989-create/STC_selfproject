C251 COMPILER V5.60.0,  ili9341                                                            15/11/25  12:13:33  PAGE 1   


C251 COMPILER V5.60.0, COMPILATION OF MODULE ili9341
OBJECT MODULE PLACED IN .\out_file\ili9341.obj
COMPILER INVOKED BY: D:\MDK\C251\BIN\C251.EXE ..\Hardware\ili9341.c LARGE NOALIAS FLOAT64 WARNINGLEVEL(3) OPTIMIZE(SIZE)
                    - BROWSE INCDIR(..\..\libraries\zf_common;..\..\libraries\zf_components;..\..\libraries\zf_device;..\..\libraries\zf_driv
                    -er;..\user;..\code;..\Hardware) DEBUG PRINT(.\out_file\ili9341.lst) OBJECT(.\out_file\ili9341.obj) 

stmt  level    source

    1          // #include "ili9341.h"
    2          
    3          // // ï¿½ê³£ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ P1 ï¿½Úµï¿½ CS, DC, RST ï¿½ï¿½ï¿½ï¿½
    4          // #define LCD_CTRL_PINS_MASK (0x01 | 0x02 | 0x08)
    5          
    6          // // --- 1. STC32G SPI Ó²ï¿½ï¿½ï¿½ï¿½Ê¼ï¿½ï¿½ (ï¿½ï¿½ï¿½ Flash ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ P_SW1 ï¿½ï¿½ SPCTL ï¿½
             -ß¼ï¿½) ---
    7          // void self_SPI_Init(void)
    8          // {
    9          //     // Ê¹ï¿½ï¿½ï¿½ï¿½Õ¹ï¿½Ä´ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½
   10          //     EAXFR = 1; 
   11              
   12          //     // --- 1.1 ï¿½ï¿½ï¿½Ã¿ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ P1.0, P1.1, P1.3 Ä£Ê½ ---
   13          //     // ï¿½ï¿½ï¿½ï¿½Îªï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ (ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ê¹ï¿½ï¿½Í¨ï¿½Ã·ï¿½Ê½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿
             -½ï¿½ï¿½Ä»ï¿½ï¿½ï¿½ï¿½Ç¿ï¿½Â©ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½)
   14          //     P1M0 |= LCD_CTRL_PINS_MASK; 
   15          //     P1M1 &= ~LCD_CTRL_PINS_MASK;
   16              
   17          //     // --- 1.2 ï¿½ï¿½ï¿½ï¿½ SPI ï¿½ï¿½ï¿½ï¿½ P2.2, P2.3, P2.4, P2.5 Ä£Ê½ ---
   18          //     // P2.2 (SCLK), P2.3 (MOSI) ï¿½ï¿½ï¿½ï¿½Îªï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½
   19          //     P2M0 |= (1<<2) | (1<<3); 
   20          //     P2M1 &= ~((1<<2) | (1<<3));
   21          //     // P2.4 (MISO) ï¿½ï¿½ï¿½ï¿½Îªï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ (0, 0)
   22          //     P2M0 &= ~(1<<4);
   23          //     P2M1 &= ~(1<<4);
   24          
   25          //     // --- 1.3 ï¿½ï¿½ï¿½Ã±ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ P3.7 Îªï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ ---
   26          //     P3M0 |= (1<<7);
   27          //     P3M1 &= ~(1<<7);
   28          
   29          //     // --- 1.4 ï¿½ï¿½ï¿½ï¿½ SPI ï¿½ï¿½ï¿½Å¸ï¿½ï¿½ï¿½ (P_SW1) ---
   30          //     // ï¿½ï¿½Ó¦ P_SW1: SPI_S1=0, SPI_S0=1 -> 0x04 (P2 ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½)
   31          //     P_SW1 = (P_SW1 & ~(3<<2)) | (1<<2); 
   32          
   33          //     // --- 1.5 ï¿½ï¿½ï¿½ï¿½ SPI ï¿½ï¿½ï¿½Æ¼Ä´ï¿½ï¿½ï¿½ (SPCTL) ---
   34          //     SSIG = 1;     // ï¿½ï¿½ï¿½ï¿½ SS ï¿½ï¿½ï¿½Å¹ï¿½ï¿½ï¿½
   35          //     SPEN = 1;     // Ê¹ï¿½ï¿½ SPI ï¿½ï¿½ï¿½ï¿½
   36          //     DORD = 0;     // MSB ï¿½ï¿½Ç°
   37          //     MSTR = 1;     // ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ä£Ê½ (Master)
   38          //     CPOL = 0;     // SPI Ä£Ê½ 0: Ê±ï¿½Ó¿ï¿½ï¿½ÐµÍµï¿½Æ½
   39          //     CPHA = 0;     // SPI Ä£Ê½ 0: ï¿½ï¿½Ò»ï¿½ï¿½Ê±ï¿½Ó±ï¿½ï¿½Ø²ï¿½ï¿½ï¿½
   40              
   41          //     // ï¿½ï¿½ï¿½ï¿½ï¿½Ê·ï¿½Æµ (ï¿½ï¿½ï¿½ï¿½ï¿½ Fosc/2T ï¿½ï¿½ Fosc/4)
   42          //     SPCTL = (SPCTL & ~3) | 3; 
   43          //     HSCLKDIV = 0x08;          // ï¿½ï¿½ï¿½Í¸ï¿½ï¿½ï¿½Ê±ï¿½Ó·ï¿½Æµ
   44              
   45          //     // ï¿½ï¿½ï¿½×´Ì¬ï¿½ï¿½Ö¾
   46          //     SPIF = 1; 
   47          //     WCOL = 1; 
   48          // }
   49          
   50          // // --- 2. SPI ï¿½×²ï¿½Í¨ï¿½Åºï¿½ï¿½ï¿½ ---
   51          
   52          // // SPI ï¿½ï¿½ï¿½ï¿½Ò»ï¿½ï¿½ï¿½Ö½ï¿½ï¿½ï¿½ï¿½ï¿½
   53          // void LCD_Writ_Bus(unsigned char dat) 
   54          // {
   55          //     SPDAT = dat; 
C251 COMPILER V5.60.0,  ili9341                                                            15/11/25  12:13:33  PAGE 2   

   56          //     while(SPIF == 0); // ï¿½È´ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½
   57          //     SPIF = 1; ? ? ? ? // ï¿½ï¿½ï¿½ SPIF ï¿½ï¿½Ö¾
   58          // }
   59          
   60          // // Ð´ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ (DC=0)
   61          // void LCD_WR_REG(unsigned char cmd)
   62          // {
   63          //     LCD_CS_CLR; 
   64          //     LCD_DC_CLR; // ï¿½ï¿½ï¿½ï¿½Ä£Ê½
   65          //     LCD_Writ_Bus(cmd);
   66          //     LCD_CS_SET; 
   67          // }
   68          
   69          // // Ð´ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ (DC=1)
   70          // void LCD_WR_DATA(unsigned char dat)
   71          // {
   72          //     LCD_CS_CLR; 
   73          //     LCD_DC_SET; // ï¿½ï¿½ï¿½ï¿½Ä£Ê½
   74          //     LCD_Writ_Bus(dat);
   75          //     LCD_CS_SET; 
   76          // }
   77          
   78          // // Ð´ï¿½ï¿½16Î»ï¿½ï¿½ï¿½ï¿½ (ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½É«)
   79          // void LCD_WR_DATA_16Bit(unsigned int dat)
   80          // {
   81          //     LCD_CS_CLR;
   82          //     LCD_DC_SET;
   83          //     // Ð´ï¿½ï¿½ß°ï¿½Î»
   84          //     LCD_Writ_Bus(dat >> 8); 
   85          //     // Ð´ï¿½ï¿½Í°ï¿½Î»
   86          //     LCD_Writ_Bus(dat & 0xFF);
   87          //     LCD_CS_SET;
   88          // }
   89          
   90          // // --- 3. ï¿½ï¿½Ä»ï¿½ï¿½ï¿½Æºï¿½ï¿½ï¿½ ---
   91          
   92          // // Ó²ï¿½ï¿½ï¿½ï¿½Î»
   93          // void LCD_RST(void)
   94          // {
   95          //     LCD_RST_CLR; // ï¿½ï¿½ï¿½Í¸ï¿½Î»
   96          //     system_delay_ms(100);
   97          //     LCD_RST_SET; // ï¿½Í·Å¸ï¿½Î»
   98          //     system_delay_ms(100);
   99          // }
  100          
  101          // // ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ê¾ï¿½ï¿½ï¿½ï¿½
  102          // void LCD_SetWindows(unsigned int Xstart, unsigned int Ystart, unsigned int Xend, unsigned int Yend)
  103          // {
  104          //     // ï¿½ï¿½ï¿½ï¿½ï¿½Ðµï¿½Ö· (0x2A)
  105          //     LCD_WR_REG(0x2A); 
  106          //     LCD_WR_DATA(Xstart >> 8); 
  107          //     LCD_WR_DATA(Xstart & 0xFF);
  108          //     LCD_WR_DATA(Xend >> 8); 
  109          //     LCD_WR_DATA(Xend & 0xFF);
  110          
  111          //     // ï¿½ï¿½ï¿½ï¿½ï¿½Ðµï¿½Ö· (0x2B)
  112          //     LCD_WR_REG(0x2B);
  113          //     LCD_WR_DATA(Ystart >> 8);
  114          //     LCD_WR_DATA(Ystart & 0xFF);
  115          //     LCD_WR_DATA(Yend >> 8);
  116          //     LCD_WR_DATA(Yend & 0xFF);
  117          
  118          //     // ×¼ï¿½ï¿½Ð´ï¿½ï¿½ GRAM
  119          //     LCD_WR_REG(0x2C);
  120          // }
  121          
C251 COMPILER V5.60.0,  ili9341                                                            15/11/25  12:13:33  PAGE 3   

  122          // // --- 4. ILI9341 ï¿½ï¿½Ê¼ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ ---
  123          // void LCD_Init(void)
  124          // {
  125          //     // 1. Ó²ï¿½ï¿½ï¿½ï¿½Î»
  126          //     LCD_RST(); // ï¿½ï¿½ï¿½Í¸ï¿½Î», ï¿½ï¿½Ê±, ï¿½ï¿½ï¿½ï¿½ï¿½Í·ï¿½
  127          
  128          //     // 2. ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ê¼ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ (Í¨ï¿½ï¿½Ë³ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½)
  129          
  130          //     // --- Ð¾Æ¬ï¿½ï¿½ï¿½ï¿½ï¿½Ìµï¿½Ë½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ (Command Group A) ---
  131          //     // Power Control A (CFh)
  132          //     LCD_WR_REG(0xCF);   
  133          //     LCD_WR_DATA(0x00); 
  134          //     LCD_WR_DATA(0xC1); 
  135          //     LCD_WR_DATA(0x30); 
  136          
  137          //     // Power Control B (EDh)
  138          //     LCD_WR_REG(0xED);   
  139          //     LCD_WR_DATA(0x64); 
  140          //     LCD_WR_DATA(0x03); 
  141          //     LCD_WR_DATA(0x12); 
  142          //     LCD_WR_DATA(0x81); 
  143          
  144          //     // Driver timing control A (E8h)
  145          //     LCD_WR_REG(0xE8);
  146          //     LCD_WR_DATA(0x85); 
  147          //     LCD_WR_DATA(0x01); 
  148          //     LCD_WR_DATA(0x79); 
  149          
  150          //     // Driver timing control B (EAh)
  151          //     LCD_WR_REG(0xEA);
  152          //     LCD_WR_DATA(0x00); 
  153          //     LCD_WR_DATA(0x00); 
  154          
  155          //     // Power on Sequence control (CBh)
  156          //     LCD_WR_REG(0xCB);
  157          //     LCD_WR_DATA(0x39); 
  158          //     LCD_WR_DATA(0x2C); 
  159          //     LCD_WR_DATA(0x00); 
  160          //     LCD_WR_DATA(0x34); 
  161          //     LCD_WR_DATA(0x02); 
  162          
  163          //     // Pump ratio control (F7h)
  164          //     LCD_WR_REG(0xF7);
  165          //     LCD_WR_DATA(0x20); 
  166          
  167          //     // --- ï¿½ï¿½ï¿½Äµï¿½Ô´ï¿½ï¿½ VCOM ï¿½ï¿½ï¿½ï¿½ ---
  168              
  169          //     // Power Control 1 (C0h) - ï¿½ï¿½ï¿½ï¿½ GVDD (Voltage)
  170          //     LCD_WR_REG(0xC0);   
  171          //     LCD_WR_DATA(0x23);  // VRH[5:0] = 3.6V (ï¿½ï¿½ï¿½ï¿½Öµ)
  172          
  173          //     // Power Control 2 (C1h) - ï¿½ï¿½ï¿½ï¿½ AVDD/VCL/VGH/VGL
  174          //     LCD_WR_REG(0xC1);   
  175          //     LCD_WR_DATA(0x10);  // SAP[2:0];BT[3:0]
  176          
  177          //     // VCOM Control 1 (C5h) - ï¿½ï¿½ï¿½ï¿½ VCOM ï¿½ï¿½Ñ¹ (VCM)
  178          //     LCD_WR_REG(0xC5);   
  179          //     LCD_WR_DATA(0x3E);  // VCOM = 4.25V (ï¿½ï¿½ï¿½ï¿½Öµ 1)
  180          //     LCD_WR_DATA(0x28);  // VCOM = 3.7V (ï¿½ï¿½ï¿½ï¿½Öµ 2)
  181          
  182          //     // VCOM Control 2 (C7h) - ï¿½ï¿½ï¿½ï¿½ VCOM AC/DC
  183          //     LCD_WR_REG(0xC7);   
  184          //     LCD_WR_DATA(0x86);  // VCOMH=VCOM_REG, VCML=VCOM_REG
  185          
  186          //     // --- ï¿½ï¿½Ê¾ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ ---
  187          
C251 COMPILER V5.60.0,  ili9341                                                            15/11/25  12:13:33  PAGE 4   

  188          //     // Memory Access Control (36h) - ï¿½ï¿½ï¿½ï¿½ GRAM É¨ï¿½è·½ï¿½ï¿½
  189          //     // 0x48 (ï¿½ï¿½ï¿½ï¿½) ï¿½ï¿½ 0x28 (ï¿½ï¿½ï¿½ï¿½) ï¿½ï¿½ï¿½î³£ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½
  190          //     LCD_WR_REG(0x36);   
  191          //     LCD_WR_DATA(0x48); // B7:MY=0, B6:MX=1, B5:MV=0, B4:ML=0, B3:RGB=1 (RGB ï¿½ï¿½Ê½)
  192          
  193          //     // Pixel Format Set (3Ah) - ï¿½ï¿½ï¿½Ã½Ó¿ï¿½ï¿½ï¿½ï¿½Ø¸ï¿½Ê½
  194          //     // 0x55 = 16 bit/ï¿½ï¿½ï¿½ï¿½ (RGB565)
  195          //     LCD_WR_REG(0x3A);   
  196          //     LCD_WR_DATA(0x55); 
  197          
  198          //     // Frame Rate Control (B1h) - ï¿½ï¿½ï¿½ï¿½Ö¡ï¿½ï¿½
  199          //     LCD_WR_REG(0xB1);   
  200          //     LCD_WR_DATA(0x00); 
  201          //     LCD_WR_DATA(0x18);  // 72Hz
  202          
  203          //     // Display Function Control (B6h)
  204          //     LCD_WR_REG(0xB6);   
  205          //     LCD_WR_DATA(0x08);  // 08h: ï¿½ï¿½Í¨Ä£Ê½
  206          //     LCD_WR_DATA(0xA2); 
  207          //     LCD_WR_DATA(0x27);
  208          
  209          //     // 3. ï¿½Ë³ï¿½Ë¯ï¿½ï¿½Ä£Ê½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ê¾
  210          
  211          //     // Sleep Out (11h) - ï¿½Ë³ï¿½Ë¯ï¿½ï¿½Ä£Ê½
  212          //     LCD_WR_REG(0x11);
  213          //     system_delay_ms(120); // ï¿½ï¿½ï¿½ï¿½È´ï¿½ 120ms ï¿½ï¿½ï¿½ï¿½
  214          
  215          //     // Display ON (29h) - ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ê¾
  216          //     LCD_WR_REG(0x29); 
  217              
  218          //     // Ä¬ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ñ¡ï¿½ï¿½
  219          //     // LCD_Clear(BLACK);
  220          // }
  221          
  222          // // --- 5. ï¿½ï¿½Í¼ï¿½ï¿½ï¿½ï¿½Êµï¿½ï¿½ ---
  223          
  224          // // ï¿½ï¿½ï¿½ï¿½
  225          // void LCD_Clear(unsigned int Color)
  226          // {
  227          //     unsigned int i;
  228          //     unsigned long total_points = (unsigned long)LCD_W * LCD_H;
  229          
  230          //     LCD_SetWindows(0, 0, LCD_W - 1, LCD_H - 1);
  231              
  232          //     LCD_CS_CLR;
  233          //     LCD_DC_SET; // ï¿½ï¿½ï¿½ï¿½Ð´ï¿½ï¿½ï¿½ï¿½ï¿½Ý£ï¿½ï¿½ï¿½ï¿½ï¿½DCï¿½ßµï¿½Æ½
  234              
  235          //     for(i = 0; i < total_points; i++)
  236          //     {
  237          //         // Ð´ï¿½ï¿½ß°ï¿½Î»ï¿½ÍµÍ°ï¿½Î»
  238          //         LCD_Writ_Bus(Color >> 8); 
  239          //         LCD_Writ_Bus(Color & 0xFF);
  240          //     }
  241          //     LCD_CS_SET;
  242          // }
  243          
  244          // // ï¿½ï¿½ï¿½ï¿½
  245          // void LCD_DrawPoint(unsigned int x, unsigned int y, unsigned int color)
  246          // {
  247          //     if(x >= LCD_W || y >= LCD_H) return;
  248              
  249          //     // ï¿½ï¿½ï¿½Ãµï¿½ï¿½ï¿½ï¿½ï¿½Ä´ï¿½ï¿½ï¿½
  250          //     LCD_SetWindows(x, y, x, y);
  251          //     // Ð´ï¿½ï¿½16Î»ï¿½ï¿½É«
  252          //     LCD_WR_DATA_16Bit(color);
  253          // }
C251 COMPILER V5.60.0,  ili9341                                                            15/11/25  12:13:33  PAGE 5   

  254          
  255          // // ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½
  256          // void LCD_Fill(unsigned int xsta, unsigned int ysta, unsigned int xend, unsigned int yend, unsigned int
             - color)
  257          // {
  258          //     unsigned long i;
  259          //     unsigned long total_points = (unsigned long)(xend - xsta + 1) * (yend - ysta + 1);
  260          
  261          //     if(xend >= LCD_W || yend >= LCD_H) return;
  262              
  263          //     LCD_SetWindows(xsta, ysta, xend, yend);
  264              
  265          //     LCD_CS_CLR;
  266          //     LCD_DC_SET; // ï¿½ï¿½ï¿½ï¿½Ð´ï¿½ï¿½ï¿½ï¿½ï¿½Ý£ï¿½ï¿½ï¿½ï¿½ï¿½DCï¿½ßµï¿½Æ½
  267          
  268          //     for(i = 0; i < total_points; i++)
  269          //     {
  270          //         // Ð´ï¿½ï¿½ß°ï¿½Î»
  271          //         LCD_Writ_Bus(color >> 8); 
  272          //         // Ð´ï¿½ï¿½Í°ï¿½Î»
  273          //         LCD_Writ_Bus(color & 0xFF);
  274          //     }
  275          //     LCD_CS_SET;
  276          // }
*** WARNING C38 IN LINE 276 OF ..\Hardware\ili9341.c: empty translation unit


Module Information          Static   Overlayable
------------------------------------------------
  code size            =    ------     ------
  ecode size           =    ------     ------
  data size            =    ------     ------
  idata size           =    ------     ------
  pdata size           =    ------     ------
  xdata size           =    ------     ------
  xdata-const size     =    ------     ------
  edata size           =    ------     ------
  bit size             =    ------     ------
  ebit size            =    ------     ------
  bitaddressable size  =    ------     ------
  ebitaddressable size =    ------     ------
  far data size        =    ------     ------
  huge data size       =    ------     ------
  const size           =    ------     ------
  hconst size          =    ------     ------
End of Module Information.


C251 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)
